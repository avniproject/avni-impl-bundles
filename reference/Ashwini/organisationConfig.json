{
  "uuid" : "26d1eff4-0f32-4680-bfcb-36a85d2ec51d",
  "settings" : {
    "extensions" : [ {
      "label" : "ASHWINI",
      "fileName" : "ASHWINI-logo-on-splash-screen.html",
      "extensionScope" : {
        "name" : "Field App Home Screen",
        "uuid" : "",
        "scopeType" : "Field App Home Screen"
      }
    } ],
    "languages" : [ "en" ],
    "customRegistrationLocations" : [ ],
    "donotRequirePasswordChangeOnFirstLogin" : false,
    "showHierarchicalLocation" : false,
    "maxAddressDisplayInlineCount" : 0,
    "searchResultFields" : [ {
      "subjectTypeName" : "Individual",
      "subjectTypeUUID" : "9f2af1f9-e150-4f8e-aad3-40bb7eb05aa3",
      "searchResultConcepts" : [ {
        "name" : "Sangam Number",
        "uuid" : "c9e64f06-23ac-47dc-b7e4-c93b819f52ce",
        "displayOrder" : 1
      }, {
        "name" : "Tribe",
        "uuid" : "14c794f1-2db6-4646-94b9-ac933b7e71bd",
        "displayOrder" : 2
      } ]
    } ],
    "searchFilters" : [ {
      "type" : "Name",
      "widget" : "Default",
      "titleKey" : "Name",
      "subjectTypeUUID" : "9f2af1f9-e150-4f8e-aad3-40bb7eb05aa3"
    }, {
      "type" : "Age",
      "widget" : "Default",
      "titleKey" : "Age",
      "subjectTypeUUID" : "9f2af1f9-e150-4f8e-aad3-40bb7eb05aa3"
    }, {
      "type" : "Concept",
      "scope" : "registration",
      "widget" : "Default",
      "titleKey" : "Sangam Number",
      "conceptName" : "Sangam Number",
      "conceptUUID" : "c9e64f06-23ac-47dc-b7e4-c93b819f52ce",
      "conceptDataType" : "Text",
      "scopeParameters" : {
        "programUUIDs" : [ ],
        "encounterTypeUUIDs" : [ ]
      },
      "subjectTypeUUID" : "9f2af1f9-e150-4f8e-aad3-40bb7eb05aa3"
    }, {
      "type" : "Address",
      "widget" : "Default",
      "titleKey" : "Address",
      "subjectTypeUUID" : "9f2af1f9-e150-4f8e-aad3-40bb7eb05aa3"
    }, {
      "type" : "SearchAll",
      "titleKey" : "Search All",
      "subjectTypeUUID" : "9f2af1f9-e150-4f8e-aad3-40bb7eb05aa3"
    } ],
    "hideTotalForProgram" : false,
    "enableRuleDesigner" : true,
    "myDashboardFilters" : [ {
      "type" : "Address",
      "widget" : "Default",
      "titleKey" : "Address",
      "subjectTypeUUID" : "9f2af1f9-e150-4f8e-aad3-40bb7eb05aa3"
    }, {
      "type" : "Concept",
      "scope" : "programEnrolment",
      "widget" : "Default",
      "titleKey" : "Chronic Diagnosis",
      "conceptName" : "Diagnosis",
      "conceptUUID" : "41c71d3e-ca74-48f0-a20e-9d48f3457194",
      "conceptDataType" : "Coded",
      "scopeParameters" : {
        "programUUIDs" : [ "9ea7ebb3-d445-4f9d-baab-5e62b7f15777" ],
        "encounterTypeUUIDs" : [ ]
      },
      "subjectTypeUUID" : "9f2af1f9-e150-4f8e-aad3-40bb7eb05aa3"
    } ]
  },
  "worklistUpdationRule" : "({params, imports}) => {\n    const workLists = params.workLists;\n    const context = params.context;\n    const RuleCondition = imports.rulesConfig.RuleCondition;\n    const WorkItem = imports.models.WorkItem;\n    const entity = context.entity;\n    const currentWorkItem = workLists.getCurrentWorkItem();\n\n    function generateUUID() {\n        const timestamp = new Date().getTime();\n        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n            const r = (timestamp + Math.random()*16)%16 | 0;\n            return (c === 'x' ? r : (r&0x3|0x8)).toString(16);\n        });\n    }\n// Cancer form\n    const programEncounter = context.entity; // Clinical Assessment Form encounter\n    const complaintFieldUuid = \"a85487f9-322a-455d-a0da-79e1437fbfaf\"; // Complaints/Symptoms UUID\n    const cancerConceptUuid = \"3fc0510a-0cb8-442a-a800-b78f4daee3c1\"; // Cancer Questionnaire concept answer UUID\n\n    const ruleCondition = new RuleCondition({ programEncounter })\n        .when.valueInEncounter(complaintFieldUuid)\n        .containsAnswerConceptName(cancerConceptUuid)\n        .matches();\n\n    if (ruleCondition) {\n        // Add the Cancer Questions form\n        workLists.addItemsToCurrentWorkList(\n            new WorkItem(\"Cancer_Screening_Questionnaire\", WorkItem.type.PROGRAM_ENCOUNTER, {\n                encounterType: \"Cancer Screening Questionnaire\",\n                subjectUUID: programEncounter.programEnrolment.individual.uuid\n            })\n        );\n        }\n// Program Exit if visited = no\n    const programExitWorklistRuleNoVisted = (programEncounter,currentWorkList) => {        \n        let isExit = false;\n        if(programEncounter.encounterType.name === 'Clinical Assessment Form'){\n            isExit = programEncounter.getObservationReadableValue(\"Why?\");\n        }\n        if(isExit) {    \n            let w = new WorkItem(generateUUID(),WorkItem.type.PROGRAM_EXIT,{\n                programName: \"POC\",\n                subjectUUID: programEncounter.programEnrolment.individual.uuid,\n                subjectTypeName: 'Individual',\n                saveAndProceedLabel: \"Exit to POC (Not Visited)\"\n            });    \n            currentWorkList.workItems.splice(0,currentWorkList.workItems.length,w);\n        }          \n    };\n    \n// Program Exit if followup = no\n    const programExitWorklistRuleFollowUp  = (programEncounter,currentWorkList) => {        \n        let isExit = false;\n        if(programEncounter.encounterType.name === 'Clinical Assessment Form'){\n            isExit = programEncounter.getObservationReadableValue(\"Need for follow-up\") == \"No\";\n        }\n        if(isExit) {    \n            let w = new WorkItem(generateUUID(),WorkItem.type.PROGRAM_EXIT,{\n                programName: \"POC\",\n                subjectUUID: programEncounter.programEnrolment.individual.uuid,\n                subjectTypeName: 'Individual',\n                saveAndProceedLabel: \"Exit – No Follow-up Needed\"\n            });    \n            currentWorkList.workItems.splice(0,currentWorkList.workItems.length,w);\n        }          \n    };\n\n// Program Exit if Exit – Other Program/Death/Migration\nconst programExitWorklistRuleLatestStatus = (programEncounter, currentWorkList) => {        \n    let isExit = false;\n    if (programEncounter.encounterType.name === 'POC Follow-up Visit Form') {\n        const status = programEncounter.getObservationReadableValue(\"Latest Status of the Patient\");\n        const exitStatuses = [\"Death\", \"Enrolled into Other Programmes\", \"Migration\"];\n        if (Array.isArray(status)) {\n            isExit = status.some(s => exitStatuses.includes((s || '').trim()));\n        } else {\n            isExit = exitStatuses.includes((status || '').trim());\n        }\n    }\n    if (isExit) {    \n        let w = new WorkItem(generateUUID(), WorkItem.type.PROGRAM_EXIT, {\n            programName: \"POC\",\n            subjectUUID: programEncounter.programEnrolment.individual.uuid,\n            subjectTypeName: 'Individual',\n            saveAndProceedLabel: \"Exit – Other Program/Death/Migration\"\n        });    \n        currentWorkList.workItems.splice(0, currentWorkList.workItems.length, w);\n    }          \n};\n// Program Exit if the first follow-up is completed\n    const programExitWorklistRuleFollowUpcomplete  = (programEncounter,currentWorkList) => {        \n        let isExit = false;\n        if(programEncounter.encounterType.name === 'POC Follow-up Visit Form'){\n            isExit = programEncounter.getObservationReadableValue(\"Local Support\");\n        }\n        if(isExit) {    \n            let w = new WorkItem(generateUUID(),WorkItem.type.PROGRAM_EXIT,{\n                programName: \"POC\",\n                subjectUUID: programEncounter.programEnrolment.individual.uuid,\n                subjectTypeName: 'Individual',\n                saveAndProceedLabel: \"Exit – No Follow-up Needed\"\n            });    \n            currentWorkList.workItems.splice(0,currentWorkList.workItems.length,w);\n        }          \n    };\n    \n// Program Exit if followup in folloup form= no\n    const programExitWorklistRulePOCFollowUp  = (programEncounter,currentWorkList) => {        \n        let isExit = false;\n        if(programEncounter.encounterType.name === 'POC Follow-up Visit Form'){\n            isExit = programEncounter.getObservationReadableValue(\"Need for follow-up\") == \"No\";\n        }\n        if(isExit) {    \n            let w = new WorkItem(generateUUID(),WorkItem.type.PROGRAM_EXIT,{\n                programName: \"POC\",\n                subjectUUID: programEncounter.programEnrolment.individual.uuid,\n                subjectTypeName: 'Individual',\n                saveAndProceedLabel: \"Exit – No Follow-up Needed\"\n            });    \n            currentWorkList.workItems.splice(0,currentWorkList.workItems.length,w);\n        }          \n    };    \n    const main = (workLists) => {\n        const {type} = currentWorkItem;\n\n        if(type === WorkItem.type.PROGRAM_ENCOUNTER){\n            if(entity.programEnrolment.program.name === 'POC') {\n              programExitWorklistRuleFollowUp(entity,workLists.currentWorkList);\n              programExitWorklistRuleNoVisted(entity, workLists.currentWorkList);\n              programExitWorklistRuleLatestStatus(entity, workLists.currentWorkList);\n              programExitWorklistRulePOCFollowUp(entity, workLists.currentWorkList);\n              programExitWorklistRuleFollowUpcomplete(entity, workLists.currentWorkList);  \n            }\n            \n        }\n        return workLists;\n    };\n\n    return main(workLists);\n\n};"
}