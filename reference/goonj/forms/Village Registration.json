{
  "name" : "Village Registration",
  "uuid" : "c3d90e78-a3b1-43fb-8f03-96eb2463d8fe",
  "formType" : "IndividualProfile",
  "formElementGroups" : [ {
    "uuid" : "556cdb63-0179-4066-922f-6f45d2bf4df7",
    "name" : "Nothing",
    "displayOrder" : 1.0,
    "formElements" : [ ],
    "voided" : true,
    "display" : "Nothing",
    "timed" : false
  }, {
    "uuid" : "62031466-a23c-4a76-a52e-312181436d95",
    "name" : "_",
    "displayOrder" : 2.0,
    "formElements" : [ ],
    "voided" : true,
    "display" : "_",
    "timed" : false
  }, {
    "uuid" : "ba14ac35-263f-4cfd-8afe-172026eaae7b",
    "name" : "‎",
    "displayOrder" : 3.0,
    "formElements" : [ {
      "name" : "‎​Please Proceed To Next Page",
      "uuid" : "e3497695-91cb-484a-8f61-2c4f0ee0ea32",
      "keyValues" : [ ],
      "concept" : {
        "name" : "dummy",
        "uuid" : "92f359cd-a199-4820-8638-f37fa9a0472b",
        "dataType" : "Coded",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 1.0,
      "type" : "SingleSelect",
      "voided" : true,
      "mandatory" : false
    } ],
    "rule" : "",
    "voided" : true,
    "display" : "‎",
    "timed" : false
  }, {
    "uuid" : "5712113e-509e-4c7a-bacd-4038808474ed",
    "name" : "​",
    "displayOrder" : 4.0,
    "formElements" : [ {
      "name" : "​",
      "uuid" : "5a1c48f7-0083-4951-b596-0a4b373908a3",
      "keyValues" : [ ],
      "concept" : {
        "name" : "dummy",
        "uuid" : "92f359cd-a199-4820-8638-f37fa9a0472b",
        "dataType" : "Coded",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 1.0,
      "type" : "SingleSelect",
      "voided" : true,
      "mandatory" : false
    } ],
    "voided" : true,
    "display" : "​",
    "timed" : false
  }, {
    "uuid" : "6f92a7b7-71ec-4b54-b0de-c8306a481c37",
    "name" : "Geography information",
    "displayOrder" : 5.0,
    "formElements" : [ {
      "name" : "hidden",
      "uuid" : "4be0a1d3-30d4-4c6e-b485-466edee8b93d",
      "keyValues" : [ ],
      "concept" : {
        "name" : "hidden",
        "uuid" : "16b34bfc-00e6-4021-9dbe-1ee569475e37",
        "dataType" : "Text",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 1.0,
      "type" : "SingleSelect",
      "rule" : "'use strict';\n({params, imports}) => {\n  const individual = params.entity;\n  const moment = imports.moment;\n  const formElement = params.formElement;\n  const _ = imports.lodash;\n  let visibility = true;\n  let value = null;\n  let answersToSkip = [];\n  let validationErrors = [];\n  \n  visibility = !(true);\n  \n  return new imports.rulesConfig.FormElementStatus(formElement.uuid, visibility, value, answersToSkip, validationErrors);\n};",
      "declarativeRule" : [ {
        "actions" : [ {
          "actionType" : "hideFormElement"
        }, { } ],
        "conditions" : [ {
          "compoundRule" : {
            "rules" : [ {
              "lhs" : { },
              "rhs" : { }
            } ]
          }
        } ]
      } ],
      "voided" : true,
      "mandatory" : false
    }, {
      "name" : "Account  name",
      "uuid" : "98625bb5-de99-4626-bdce-9871a71e19df",
      "keyValues" : [ ],
      "concept" : {
        "name" : "Account  name",
        "uuid" : "2978117c-a297-4171-99c6-23c3522ca0f8",
        "dataType" : "Text",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 2.0,
      "type" : "SingleSelect",
      "voided" : true,
      "mandatory" : true
    }, {
      "name" : "Other Location Details",
      "uuid" : "a737756a-93b1-497f-a4d3-89af0cc33d40",
      "keyValues" : [ ],
      "concept" : {
        "name" : "dummy",
        "uuid" : "92f359cd-a199-4820-8638-f37fa9a0472b",
        "dataType" : "Coded",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 3.0,
      "type" : "SingleSelect",
      "voided" : true,
      "mandatory" : false
    }, {
      "name" : "Other Location Details",
      "uuid" : "1021e3ee-c37d-41d5-b4f8-eae7824ddf37",
      "keyValues" : [ ],
      "concept" : {
        "name" : "dummy",
        "uuid" : "92f359cd-a199-4820-8638-f37fa9a0472b",
        "dataType" : "Coded",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 4.0,
      "type" : "SingleSelect",
      "rule" : "//SAMPLE RULE EXAMPLE\n'use strict';\n({params, imports}) => {\n  const individual = params.entity;\n  const formElement = params.formElement;\n  individual.first_name = individual.lowestAddressLevel.name;\n  const statusBuilder = new imports.rulesConfig.FormElementStatusBuilder({individual, formElement});\n  //read the value of form element using individual.getObservationValue(CONCEPT_NAME);\n  const formElementValue1 = \"1\";\n  const formElementValue2 = \"1\";\n  //form element will be shown only when below condition is true\n  const showCondition = formElementValue1 === formElementValue2;\n  statusBuilder.show().whenItem(showCondition).is.truthy;\n  //for form element validation error\n  if(!showCondition){\n  statusBuilder.validationError(\"Values are not equal\");\n  }\n  return statusBuilder.build();\n};",
      "mandatory" : false
    }, {
      "name" : "Other Block",
      "uuid" : "db1ab735-962f-421b-af58-d26e315074bf",
      "keyValues" : [ ],
      "concept" : {
        "name" : "Other Block",
        "uuid" : "e2d35dee-c34f-4f54-a68b-f32ee81835b6",
        "dataType" : "Text",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 5.0,
      "type" : "SingleSelect",
      "rule" : "'use strict';\n({params, imports}) => {\n  const individual = params.entity;\n  const moment = imports.moment;\n  const formElement = params.formElement;\n  const _ = imports.lodash;\n  let visibility = false;\n  let value = null;\n  let answersToSkip = [];\n  let validationErrors = [];\n\n\n  console.log('individual', individual);  \n\n  const isDefined = individual && \n                    individual.lowestAddressLevel && \n                    (Array.isArray(individual.lowestAddressLevel.locationMappings) && \n                     !_.isEmpty(individual.lowestAddressLevel.locationMappings) || \n                     !_.isEmpty(individual.lowestAddressLevel.titleLineage));\n                     \n    function toStartCase(str) {\n        return str\n        .toLowerCase()\n        .split(/[\\s_-]+/)\n        .map(word => word.charAt(0).toUpperCase() + word.slice(1))\n        .join(' ');\n    }  \n                   \n   console.log('isDefined', isDefined);  \n\n  if (isDefined) {\n        let block = undefined;\n\n        console.log('in');  \n        \n        if (  \n            Array.isArray(individual.lowestAddressLevel.locationMappings) &&\n            !_.isEmpty(individual.lowestAddressLevel.locationMappings) &&\n            individual.lowestAddressLevel.locationMappings[0] &&\n            individual.lowestAddressLevel.locationMappings[0].parent &&\n            individual.lowestAddressLevel.locationMappings[0].parent.name\n        ) {\n            console.log('inin');\n            block = individual.lowestAddressLevel.locationMappings[0].parent.name;\n        } else if (\n            individual.lowestAddressLevel &&\n            individual.lowestAddressLevel.titleLineage\n        ) {\n            console.log('ininin');\n            const titleParts = _.split(individual.lowestAddressLevel.titleLineage, ', ');\n            block = titleParts.length > 2 ? titleParts[2] : undefined;\n        }\n        \n        visibility = block === 'Other';\n        console.log('visibility', visibility);\n    }\n\n        \n    \n  return new imports.rulesConfig.FormElementStatus(formElement.uuid, visibility,value, answersToSkip, validationErrors);\n};",
      "mandatory" : true
    }, {
      "name" : "Other Village",
      "uuid" : "824a8295-3c12-4e9a-a302-c6f6beb3e772",
      "keyValues" : [ ],
      "concept" : {
        "name" : "Other Village",
        "uuid" : "16b4db7c-e0a8-41f1-ac67-07470a762d9f",
        "dataType" : "Text",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 6.0,
      "type" : "SingleSelect",
      "rule" : "'use strict';\n({params, imports}) => {\n  const individual = params.entity;\n  const moment = imports.moment;\n  const formElement = params.formElement;\n  const _ = imports.lodash;\n  let visibility = false;\n  \n  const isDefined = individual && \n                    individual.lowestAddressLevel && \n                    (Array.isArray(individual.lowestAddressLevel.locationMappings) && \n                     !_.isEmpty(individual.lowestAddressLevel.locationMappings) || \n                     !_.isEmpty(individual.lowestAddressLevel.titleLineage));\n\n  if (isDefined) {\n      let village = undefined;\n  \n      if (\n        Array.isArray(individual.lowestAddressLevel.locationMappings) &&\n        !_.isEmpty(individual.lowestAddressLevel.locationMappings) &&\n        individual.lowestAddressLevel.locationMappings[0] &&\n        individual.lowestAddressLevel.locationMappings[0].child &&\n        individual.lowestAddressLevel.locationMappings[0].child.name\n      ) {\n        village = individual.lowestAddressLevel.locationMappings[0].child.name;\n      } else if (\n        individual.lowestAddressLevel &&\n        individual.lowestAddressLevel.titleLineage\n      ) {\n        const titleParts = _.split(individual.lowestAddressLevel.titleLineage, ', ');\n        village = titleParts.length > 3 ? titleParts[3] : undefined;\n      }\n      \n\n  \n      visibility = village === 'Other';\n  }\n\n  return new imports.rulesConfig.FormElementStatus(formElement.uuid, visibility);\n};",
      "mandatory" : true
    }, {
      "name" : "Organization Name",
      "uuid" : "e94d79e1-1006-45bf-86a4-4eeb621cb969",
      "keyValues" : [ {
        "key" : "editable",
        "value" : false
      } ],
      "concept" : {
        "name" : "Organization Name",
        "uuid" : "8f735d4d-bbd3-4190-bf05-72574fda5a93",
        "dataType" : "Text",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 7.0,
      "type" : "SingleSelect",
      "rule" : "'use strict';\n({params, imports}) => {\n  const individual = params.entity;\n  const moment = imports.moment;\n  const formElement = params.formElement;\n  const _ = imports.lodash;\n  let visibility = true;\n  let value = null;\n  let answersToSkip = [];\n  let validationErrors = [];\n  \n  const condition11 = new imports.rulesConfig.RuleCondition({individual, formElement}).when.valueInRegistration(\"8f735d4d-bbd3-4190-bf05-72574fda5a93\").notDefined.matches();\n  \n  visibility = condition11 ;\n  if(condition11 ){\n    value = \"Goonj\";  \n}\n  \n  return new imports.rulesConfig.FormElementStatus(formElement.uuid, visibility, value, answersToSkip, validationErrors);\n};",
      "declarativeRule" : [ {
        "actions" : [ {
          "actionType" : "showFormElement"
        }, {
          "details" : {
            "value" : "Goonj"
          },
          "actionType" : "value"
        }, { } ],
        "conditions" : [ {
          "compoundRule" : {
            "rules" : [ {
              "lhs" : {
                "type" : "concept",
                "scope" : "registration",
                "conceptName" : "Organization Name",
                "conceptUuid" : "8f735d4d-bbd3-4190-bf05-72574fda5a93",
                "conceptDataType" : "Text"
              },
              "rhs" : { },
              "operator" : "notDefined"
            } ]
          }
        } ]
      } ],
      "voided" : true,
      "mandatory" : true
    }, {
      "name" : "Gram Panchayat",
      "uuid" : "86e652cc-b780-482b-bbbd-05b283add039",
      "keyValues" : [ ],
      "concept" : {
        "name" : "Gram Panchayat Name",
        "uuid" : "abd267d7-2c9f-4d72-aabe-fc59ce4c877f",
        "dataType" : "Text",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 8.0,
      "type" : "SingleSelect",
      "rule" : "'use strict';\n({params, imports}) => {\n  const individual = params.entity;\n  const moment = imports.moment;\n  const formElement = params.formElement;\n  const _ = imports.lodash;\n  let visibility = true;\n  let value = null;\n  let answersToSkip = [];\n  let validationErrors = [];\n  \n  const individualService = params.services.individualService;\n  \n  const villages = individualService.getSubjectsInLocation(individual.lowestAddressLevel, 'Village');\n\n\nif(villages && villages.length > 0){\n    console.log(\"Inside Error\");\n    validationErrors.push(\"Already Village is avaiable\");\n}     \n  \n  return new imports.rulesConfig.FormElementStatus(formElement.uuid, visibility, value, answersToSkip, validationErrors);\n};",
      "voided" : true,
      "mandatory" : true
    }, {
      "name" : "Other Location Details",
      "uuid" : "0bec1778-42a7-4808-9a35-2b61850f6df1",
      "keyValues" : [ ],
      "concept" : {
        "name" : "dummy",
        "uuid" : "92f359cd-a199-4820-8638-f37fa9a0472b",
        "dataType" : "Coded",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 1003.0,
      "type" : "SingleSelect",
      "voided" : true,
      "mandatory" : false
    } ],
    "rule" : "'use strict';\n({params, imports}) => {\n    const individual = params.entity;\n    const moment = imports.moment;\n    const formElementGroup = params.formElementGroup;\n    const _ = imports.lodash;\n    let visibility = true;\n    \n     function toStartCase(str) {\n        return str\n        .trim()\n        .toLowerCase()\n        .split(/[\\s]+/)\n        .map(word => word.charAt(0).toUpperCase() + word.slice(1))\n        .join(' ');\n    } \n\n    return formElementGroup.formElements.map((formElement) => {\n        if(individual) {\n            if(individual.lowestAddressLevel && individual.lowestAddressLevel.name === 'Other') {\n                const otherVillageName =\n                individual.getObservationReadableValue('16b4db7c-e0a8-41f1-ac67-07470a762d9f');\n                if (otherVillageName) {\n                    individual.firstName = toStartCase(otherVillageName);\n                    individual.name = toStartCase(otherVillageName);\n                }\n            }\n            else if(individual.lowestAddressLevel) {\n                individual.firstName = toStartCase(individual.lowestAddressLevel.name);\n                individual.name = toStartCase(individual.lowestAddressLevel.name);\n            }\n        }\n        return new imports.rulesConfig.FormElementStatus(formElement.uuid, visibility, null);\n    });\n};",
    "display" : "Geography information",
    "timed" : false
  }, {
    "uuid" : "39b952b2-ef9e-463a-92fd-1e452ac6488e",
    "name" : "Nothing",
    "displayOrder" : 6.0,
    "formElements" : [ ],
    "voided" : true,
    "display" : "Nothing",
    "timed" : false
  } ],
  "decisionRule" : "\"use strict\";\n({params, imports}) => {\n    const individual = params.entity;\n    const moment = imports.moment;\n    const decisions = params.decisions;\n    const enrolmentDecisions = [];\n    const encounterDecisions = [];\n    const registrationDecisions = [];\n    \n    function toStartCase(str) {\n        return str\n        .trim()\n        .toLowerCase()\n        .split(/[\\s]+/)\n        .map(word => word.charAt(0).toUpperCase() + word.slice(1))\n        .join(' ');\n    }  \n      \n    const block = individual.getObservationReadableValue(\"e2d35dee-c34f-4f54-a68b-f32ee81835b6\");\n    const village = individual.getObservationReadableValue(\"16b4db7c-e0a8-41f1-ac67-07470a762d9f\");\n  \n    if(block){\n        registrationDecisions.push({name: \"Other Block\", value:toStartCase(block) });  \n    }\n    if(village){\n        registrationDecisions.push({name: \"Other Village\", value:toStartCase(village) });  \n    }\n\n  \n    decisions.enrolmentDecisions.push(...enrolmentDecisions);\n    decisions.encounterDecisions.push(...encounterDecisions);\n    decisions.registrationDecisions.push(...registrationDecisions);\n    return decisions;\n};",
  "editFormRule" : "//SAMPLE EDIT FORM RULE\n\"use strict\";\n({params, imports}) => {\n    const {entity, form, services, entityContext, myUserGroups, user} = params;\n    const moment = imports.moment;\n    const userGroups = params.myUserGroups\n      .map((grp) => grp.groupName);\n    const sameUser = params.entity.createdByUUID === params.user.userUUID;\n    \n    const isUserFieldUser = userGroups.includes('Field Users');\n    const isUserFieldSupervisor = userGroups.includes('Field Supervisor');\n    \n    const isRegistrationDateWithinThreeDays = moment(entity.registrationDate).add(3, 'days').isSameOrAfter(moment(), 'day');\n    \n    const output = {\n      editable : {\n        value: (isUserFieldUser || isUserFieldSupervisor) && isRegistrationDateWithinThreeDays && sameUser,\n        messageKey: 'Edit access denied:Registration date is past 3 days or You are not allowed to edit other users data'\n      } \n    }; \n    return output;\n};",
  "visitScheduleRule" : "",
  "validationRule" : "'use strict';\n({params, imports}) => {\n  const individual = params.entity;\n  const moment = imports.moment;\n  const _ = imports.lodash;\n  const validationResults = [];\n  const individualService = params.services.individualService;\n\n  function toStartCase(str) {\n    return str\n    .trim()\n    .toLowerCase()\n    .split(/[\\s]+/)\n    .map(word => word.charAt(0).toUpperCase() + word.slice(1))\n    .join(' ');\n  }  \n\n  const isLocationMatch = (e1,e2,location) => {\n    const {uuid,name} = location;\n    const loc1 = e1.getObservationReadableValue(uuid) || \"\";\n    const loc2 = e2.getObservationReadableValue(uuid) || \"\";\n    console.log(`value of ${name} ${loc1} ${loc2}`);\n    return toStartCase(loc1) === toStartCase(loc2)\n  }\n\n  const OtherLocations = [\n    {name:\"Other Block\",uuid:\"e2d35dee-c34f-4f54-a68b-f32ee81835b6\"},\n    {name:\"Other Village\",uuid:\"16b4db7c-e0a8-41f1-ac67-07470a762d9f\"}\n  ]  \n\n\n  \n  let villages = individualService.getSubjectsInLocation(individual.lowestAddressLevel, 'Village');\n\n\n\n\n  if(villages && villages.length > 0){\n    villages =  villages.filter(({voided,uuid})=>!voided && (uuid!=individual.uuid));\n    if(villages.length > 0){\n      let isPresent = true;\n      const otherBlock = individual.getObservationReadableValue(\"e2d35dee-c34f-4f54-a68b-f32ee81835b6\");\n      const otherVillage =  individual.getObservationReadableValue(\"16b4db7c-e0a8-41f1-ac67-07470a762d9f\");\n      if(otherBlock || otherVillage){\n        villages = villages.filter(village=> isLocationMatch(village,individual,OtherLocations[0]) &&  isLocationMatch(village,individual,OtherLocations[1]))\n        if(villages.length > 0){\n          isPresent = true;\n        }else{\n          isPresent = false;\n        }\n      }\n      if(isPresent){\n        validationResults.push(imports.common.createValidationError(\"Village for specified geographical location already exists.\"));\n      }\n    }\n  }                                                              \n\n  return validationResults;\n};",
  "checklistsRule" : "",
  "decisionConcepts" : [ ]
}