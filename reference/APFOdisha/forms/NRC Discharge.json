{
  "name" : "NRC Discharge",
  "uuid" : "081750b9-55cc-43c5-9bce-4f617e71ab1e",
  "formType" : "ProgramEncounter",
  "formElementGroups" : [ {
    "uuid" : "8dc91da5-4725-4b64-9e3b-a560a5672aa6",
    "name" : "Discharge Details",
    "displayOrder" : 1.0,
    "formElements" : [ {
      "name" : "Case Type",
      "uuid" : "989c2060-bbbc-4bcb-8bdd-88afbab2c7cc",
      "keyValues" : [ {
        "key" : "editable",
        "value" : false
      } ],
      "concept" : {
        "name" : "Case Type",
        "uuid" : "355c7a26-5772-4d87-a776-270007bf0125",
        "dataType" : "Coded",
        "answers" : [ {
          "name" : "Relapsed",
          "uuid" : "b2c51de6-1cff-4d8f-a8b1-5de7093fc0f3",
          "dataType" : "NA",
          "answers" : [ ],
          "order" : 2.0,
          "active" : true,
          "media" : [ ]
        }, {
          "name" : "Defaulter",
          "uuid" : "f9ba64b3-021d-411f-aa1c-84ae82f79047",
          "dataType" : "NA",
          "answers" : [ ],
          "order" : 1.0,
          "active" : true,
          "media" : [ ]
        }, {
          "name" : "New",
          "uuid" : "e59af894-b576-4030-bc34-c95dec90967e",
          "dataType" : "NA",
          "answers" : [ ],
          "order" : 0.0,
          "active" : true,
          "media" : [ ]
        }, {
          "name" : "Referred from higher facitily",
          "uuid" : "de92b4a0-ee48-48a2-bec1-6a449fbfe783",
          "dataType" : "NA",
          "answers" : [ ],
          "order" : 3.0,
          "active" : true,
          "media" : [ ]
        } ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 1.0,
      "type" : "SingleSelect",
      "rule" : "'use strict';\n({params, imports}) => {\n  const programEncounter = params.entity;\n  const moment = imports.moment;\n  const formElement = params.formElement;\n  const _ = imports.lodash;\n  let visibility = true;\n  let value = null;\n  let answersToSkip = [];\n  let validationErrors = [];\n  \n  const lastEncounter = programEncounter.programEnrolment.lastFulfilledEncounter('NRC');\n  const val = programEncounter.getObservationReadableValue(\"Case Type\");\n  \n  \n  if(!val){\n      if(lastEncounter){ \n         const admissionStatus = lastEncounter.getObservationReadableValue(\"Admission Status\");\n          if(admissionStatus == \"Cured and discharged\"){\n              value = \"Relapsed\";\n          }\n          if(admissionStatus == \"Referred to higher facility\"){\n              value = \"Referred from higher facitily\";\n          }\n          if(admissionStatus == \"Left against Medical Advice\" || admissionStatus == \"Defaulter\" || admissionStatus == \"Admited\"){\n              value = \"Defaulter\"\n          }\n      }\n      else{\n          value = \"New\";\n      }\n  }\n  \n  \n  \n  return new imports.rulesConfig.FormElementStatus(formElement.uuid, visibility, value, answersToSkip, validationErrors);\n};",
      "voided" : true,
      "mandatory" : false
    }, {
      "name" : "Admission Status",
      "uuid" : "186f842f-e7de-41be-ae4a-8b68915dfb56",
      "keyValues" : [ ],
      "concept" : {
        "name" : "Admission Status",
        "uuid" : "055a54be-f12a-4e32-8fbc-aa2560ab88e4",
        "dataType" : "Coded",
        "answers" : [ {
          "name" : "Admited",
          "uuid" : "1cb277a5-6666-4482-9108-c9c7737ec505",
          "dataType" : "NA",
          "answers" : [ ],
          "order" : 0.0,
          "active" : true,
          "media" : [ ]
        }, {
          "name" : "Left against Medical Advice",
          "uuid" : "27c16abc-c5cb-47f8-bfc8-fbe8482a4e2c",
          "dataType" : "NA",
          "answers" : [ ],
          "order" : 3.0,
          "active" : true,
          "media" : [ ]
        }, {
          "name" : "Cured and discharged",
          "uuid" : "386053f2-b495-44b6-95ca-bcd52b0282ef",
          "dataType" : "NA",
          "answers" : [ ],
          "order" : 1.0,
          "active" : true,
          "media" : [ ]
        }, {
          "name" : "Referred to higher facility",
          "uuid" : "6c32265e-281a-4aba-895a-205c16e5b33f",
          "dataType" : "NA",
          "answers" : [ ],
          "order" : 2.0,
          "active" : true,
          "media" : [ ]
        }, {
          "name" : "Defaulter",
          "uuid" : "f9ba64b3-021d-411f-aa1c-84ae82f79047",
          "dataType" : "NA",
          "answers" : [ ],
          "order" : 4.0,
          "active" : true,
          "media" : [ ]
        }, {
          "name" : "Not Admitted",
          "uuid" : "7e1e4517-2ff0-4868-b52e-ce0c61537e68",
          "dataType" : "NA",
          "answers" : [ ],
          "order" : 5.0,
          "active" : true,
          "media" : [ ]
        } ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 2.0,
      "type" : "SingleSelect",
      "voided" : true,
      "mandatory" : true
    }, {
      "name" : "Date of admission in NRC",
      "uuid" : "ce90cfd0-b728-4b13-b542-5d12c11b0c46",
      "keyValues" : [ ],
      "concept" : {
        "name" : "Date of admission in NRC",
        "uuid" : "27d927f3-39e2-49d9-8609-bb8aa49a00ec",
        "dataType" : "Date",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 3.0,
      "type" : "SingleSelect",
      "rule" : "'use strict';\n({params, imports}) => {\n  const programEncounter = params.entity;\n  const moment = imports.moment;\n  const formElement = params.formElement;\n  const _ = imports.lodash;\n  let visibility = true;\n  let value = null;\n  let answersToSkip = [];\n  let validationErrors = [];\n  \n  const date = programEncounter.getObservationReadableValue(\"Date of admission in NRC\");\n  \n  if (date) {\n    const today = moment(programEncounter.encounterDateTime);\n    const startOfToday = today.startOf('day');\n    const twoDaysAgo = moment(programEncounter.encounterDateTime).subtract(2, 'days').startOf('day');\n    const inputDate = moment(date);\n    const condition1 = inputDate.isBetween(twoDaysAgo, startOfToday, null, '[]');\n    \n    if (!condition1) { \n        validationErrors.push(\"Date must be within the past 2 days or today\");\n    }  \n}\n  \n  return new imports.rulesConfig.FormElementStatus(formElement.uuid, visibility, value, answersToSkip, validationErrors);\n};",
      "voided" : true,
      "mandatory" : true
    }, {
      "name" : "Height at admission",
      "uuid" : "37591da9-323f-4212-944b-5da2e5ce89f4",
      "keyValues" : [ ],
      "concept" : {
        "name" : "Height at admission",
        "uuid" : "0097b1d2-a803-4fc4-a44d-d35436e9637c",
        "dataType" : "Numeric",
        "answers" : [ ],
        "lowAbsolute" : 40.0,
        "highAbsolute" : 150.0,
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 4.0,
      "type" : "SingleSelect",
      "voided" : true,
      "mandatory" : true
    }, {
      "name" : "Weight at admission",
      "uuid" : "9d77312c-684f-4da5-bbd0-d171f9521a33",
      "keyValues" : [ ],
      "concept" : {
        "name" : "Weight at admission",
        "uuid" : "9134f243-ede9-4a3a-bbf0-706f5dddbb4d",
        "dataType" : "Numeric",
        "answers" : [ ],
        "lowAbsolute" : 1.0,
        "highAbsolute" : 50.0,
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 5.0,
      "type" : "SingleSelect",
      "voided" : true,
      "mandatory" : true
    }, {
      "name" : "Nutrition status at the time of admission",
      "uuid" : "22db430b-de99-4f64-86b2-fcf9ee081af3",
      "keyValues" : [ {
        "key" : "editable",
        "value" : false
      } ],
      "concept" : {
        "name" : "Nutrition status-admission",
        "uuid" : "6dd30e50-f076-4bf2-859a-87fcd5331f0c",
        "dataType" : "Text",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 6.0,
      "type" : "SingleSelect",
      "rule" : "'use strict';\n({params, imports}) => {\n  const programEncounter = params.entity;\n  const moment = imports.moment;\n  const formElement = params.formElement;\n  const _ = imports.lodash;\n  let visibility = true;\n  let value = null;\n  let answersToSkip = [];\n  let validationErrors = [];\n  \n    const height = programEncounter.getObservationValue(\"Height at admission\");\n    const weight = programEncounter.getObservationValue(\"Weight at admission\");\n    const asOnDate = programEncounter.encounterDateTime;\n    const individual = programEncounter.programEnrolment.individual;\n    const age = programEncounter.programEnrolment.individual.getAgeInMonths();\n    \n    \n    console.log(`height ${height} weight ${weight}`);\n\n    const addIfRequired = (decisions, name, value) => {\n        if (value === -0) value = 0;\n        if (value !== undefined) decisions.push({name: name, value: value});\n    };\n\n    const getGradeforZscore = (zScore) => {\n        let grade;\n        if (zScore <= -3) {\n            grade = 3;\n        } else if (zScore > -3 && zScore < -2) {\n            grade = 2;\n        } else if (zScore >= -2) {\n            grade = 1;\n        }\n        return grade;\n    };\n\n    const zScoresForChild = ruleServiceLibraryInterfaceForSharingModules.common.getZScore(individual, asOnDate, weight, height);\n\n    const zScoreGradeStatusMappingWeightForHeight = [\n        [\"SAM\", -3],\n        [\"MAM\", -2],\n        [\"Normal\", 1],\n        [\"Normal\", 2],\n        [\"Normal\", 3],\n        [\"Normal\", Infinity],\n    ];\n\n    const weightForHeightStatus = function (zScore) {\n        let found = _.find(zScoreGradeStatusMappingWeightForHeight, function (currentStatus) {\n            return zScore <= currentStatus[1];\n        });\n        return found && found[0];\n    };\n\n    const wfhStatus = weightForHeightStatus(zScoresForChild.wfh);\n    const wfhGrade = getGradeforZscore(zScoresForChild.wfh);\n    \n    value = wfhStatus;\n\n  return new imports.rulesConfig.FormElementStatus(formElement.uuid, visibility, value, answersToSkip, validationErrors);\n};",
      "voided" : true,
      "mandatory" : false
    }, {
      "name" : "Nutrition status at the time of admission",
      "uuid" : "a7f96ab0-6018-43bb-833b-b9b17673e455",
      "keyValues" : [ ],
      "concept" : {
        "name" : "Nutrition status at the time of admission",
        "uuid" : "55f4777c-e78f-497c-a801-4b0614efd498",
        "dataType" : "Coded",
        "answers" : [ {
          "name" : "MAM",
          "uuid" : "da518460-f4ab-4fcb-89ae-3526619d43c5",
          "dataType" : "NA",
          "answers" : [ ],
          "order" : 1.0,
          "active" : true,
          "media" : [ ]
        }, {
          "name" : "SAM",
          "uuid" : "7d0229c1-e69e-4cac-8937-cdd48c8ed9dd",
          "dataType" : "NA",
          "answers" : [ ],
          "order" : 0.0,
          "active" : true,
          "media" : [ ]
        } ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 7.0,
      "type" : "SingleSelect",
      "voided" : true,
      "mandatory" : true
    }, {
      "name" : "QRT vehcile used for facilitation to medical facility",
      "uuid" : "bdf8d033-b4dd-4892-bec7-577c85e1134f",
      "keyValues" : [ ],
      "concept" : {
        "name" : "QRT vehcile used for facilitation to medical facility",
        "uuid" : "6a7e82aa-a87e-4531-aade-66dfed4d56c3",
        "dataType" : "Coded",
        "answers" : [ {
          "name" : "Yes",
          "uuid" : "8ebbf088-f292-483e-9084-7de919ce67b7",
          "dataType" : "NA",
          "answers" : [ ],
          "order" : 0.0,
          "active" : true,
          "media" : [ ]
        }, {
          "name" : "No",
          "uuid" : "a77bd700-1409-4d52-93bc-9fe32c0e169b",
          "dataType" : "NA",
          "answers" : [ ],
          "order" : 1.0,
          "active" : true,
          "media" : [ ]
        } ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 8.0,
      "type" : "SingleSelect",
      "voided" : true,
      "mandatory" : true
    }, {
      "name" : "Criteria for admission",
      "uuid" : "fe0102e2-10e2-407d-addc-aacada15e998",
      "keyValues" : [ ],
      "concept" : {
        "name" : "Criteria for admission",
        "uuid" : "0630ec1d-45bb-48fd-ba4a-0cae8ac3329a",
        "dataType" : "Coded",
        "answers" : [ {
          "name" : "Weight for height",
          "uuid" : "086a8367-37de-4daa-b242-9d83ee814853",
          "dataType" : "NA",
          "answers" : [ ],
          "order" : 0.0,
          "active" : true,
          "media" : [ ]
        }, {
          "name" : "Other medical complication",
          "uuid" : "97381570-77b1-4cb6-8c4b-7509f097d956",
          "dataType" : "NA",
          "answers" : [ ],
          "order" : 2.0,
          "active" : true,
          "media" : [ ]
        }, {
          "name" : "MUAC",
          "uuid" : "e42f6cc7-125b-4836-9d04-22a3523ac7d4",
          "dataType" : "NA",
          "answers" : [ ],
          "order" : 1.0,
          "active" : true,
          "media" : [ ]
        } ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 9.0,
      "type" : "SingleSelect",
      "voided" : true,
      "mandatory" : true
    }, {
      "name" : "Other medical complication",
      "uuid" : "f70a2ab4-9ed3-4f32-ba14-3aab73108efd",
      "keyValues" : [ ],
      "concept" : {
        "name" : "Other medical complication coded",
        "uuid" : "2e440961-b073-4d6f-898c-7f6f721d7e92",
        "dataType" : "Coded",
        "answers" : [ {
          "name" : "Other illness",
          "uuid" : "cdc4f808-a5f2-4c74-aafb-1bb024322c7e",
          "dataType" : "NA",
          "answers" : [ ],
          "order" : 4.0,
          "active" : true,
          "media" : [ ]
        }, {
          "name" : "Diarrhoea",
          "uuid" : "e8bedb2b-c9fc-4c05-a0fe-a5d58d449824",
          "dataType" : "NA",
          "answers" : [ ],
          "order" : 2.0,
          "active" : true,
          "media" : [ ]
        }, {
          "name" : "Fever",
          "uuid" : "e52444ff-f514-4dfb-835c-86925d0d8d50",
          "dataType" : "NA",
          "answers" : [ ],
          "order" : 0.0,
          "active" : true,
          "media" : [ ]
        }, {
          "name" : "Vomitting",
          "uuid" : "45caaf3b-2664-4912-9fb2-9202e067814a",
          "dataType" : "NA",
          "answers" : [ ],
          "order" : 1.0,
          "active" : true,
          "media" : [ ]
        }, {
          "name" : "Difficulty in breathing",
          "uuid" : "4c8b7986-f10e-40dd-816a-9353f77c1359",
          "dataType" : "NA",
          "answers" : [ ],
          "order" : 3.0,
          "active" : true,
          "media" : [ ]
        } ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 10.0,
      "type" : "SingleSelect",
      "rule" : "'use strict';\n({params, imports}) => {\n  const programEncounter = params.entity;\n  const moment = imports.moment;\n  const formElement = params.formElement;\n  const _ = imports.lodash;\n  let visibility = true;\n  let value = null;\n  let answersToSkip = [];\n  let validationErrors = [];\n  \n  const condition11 = new imports.rulesConfig.RuleCondition({programEncounter, formElement}).when.valueInEncounter(\"0630ec1d-45bb-48fd-ba4a-0cae8ac3329a\").containsAnswerConceptName(\"97381570-77b1-4cb6-8c4b-7509f097d956\").matches();\n  \n  visibility = condition11 ;\n  \n  return new imports.rulesConfig.FormElementStatus(formElement.uuid, visibility, value, answersToSkip, validationErrors);\n};",
      "declarativeRule" : [ {
        "actions" : [ {
          "actionType" : "showFormElement"
        }, { } ],
        "conditions" : [ {
          "compoundRule" : {
            "rules" : [ {
              "lhs" : {
                "type" : "concept",
                "scope" : "encounter",
                "conceptName" : "Criteria for admission",
                "conceptUuid" : "0630ec1d-45bb-48fd-ba4a-0cae8ac3329a",
                "conceptDataType" : "Coded"
              },
              "rhs" : {
                "type" : "answerConcept",
                "answerConceptNames" : [ "Other medical complication" ],
                "answerConceptUuids" : [ "97381570-77b1-4cb6-8c4b-7509f097d956" ]
              },
              "operator" : "containsAnswerConceptName"
            } ]
          }
        } ]
      } ],
      "voided" : true,
      "mandatory" : true
    }, {
      "name" : "Other illness, please specify",
      "uuid" : "858e4e7d-a198-4766-b3ab-3c16d11f1a9c",
      "keyValues" : [ ],
      "concept" : {
        "name" : "Other illness, please specify",
        "uuid" : "94942a24-6b53-4f71-b7c8-1da9f3ef6219",
        "dataType" : "Text",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 11.0,
      "type" : "SingleSelect",
      "rule" : "'use strict';\n({params, imports}) => {\n  const programEncounter = params.entity;\n  const moment = imports.moment;\n  const formElement = params.formElement;\n  const _ = imports.lodash;\n  let visibility = true;\n  let value = null;\n  let answersToSkip = [];\n  let validationErrors = [];\n  \n  const condition11 = new imports.rulesConfig.RuleCondition({programEncounter, formElement}).when.valueInEncounter(\"2e440961-b073-4d6f-898c-7f6f721d7e92\").containsAnswerConceptName(\"cdc4f808-a5f2-4c74-aafb-1bb024322c7e\").matches();\n  \n  visibility = condition11 ;\n  \n  return new imports.rulesConfig.FormElementStatus(formElement.uuid, visibility, value, answersToSkip, validationErrors);\n};",
      "declarativeRule" : [ {
        "actions" : [ {
          "actionType" : "showFormElement"
        }, { } ],
        "conditions" : [ {
          "compoundRule" : {
            "rules" : [ {
              "lhs" : {
                "type" : "concept",
                "scope" : "encounter",
                "conceptName" : "Other medical complication coded",
                "conceptUuid" : "2e440961-b073-4d6f-898c-7f6f721d7e92",
                "conceptDataType" : "Coded"
              },
              "rhs" : {
                "type" : "answerConcept",
                "answerConceptNames" : [ "Other illness" ],
                "answerConceptUuids" : [ "cdc4f808-a5f2-4c74-aafb-1bb024322c7e" ]
              },
              "operator" : "containsAnswerConceptName"
            } ]
          }
        } ]
      } ],
      "voided" : true,
      "mandatory" : false
    }, {
      "name" : "Discharge Status",
      "uuid" : "f7937db7-e39f-493c-bd35-8c3ac786f296",
      "keyValues" : [ ],
      "concept" : {
        "name" : "Discharge Status",
        "uuid" : "398ccb8f-e97c-44de-a7d3-731771a10733",
        "dataType" : "Coded",
        "answers" : [ {
          "name" : "Refered to higher facility",
          "uuid" : "e9d9e7ce-b208-484c-97b7-2e8595d9a51d",
          "dataType" : "NA",
          "answers" : [ ],
          "order" : 1.0,
          "active" : true,
          "media" : [ ]
        }, {
          "name" : "Left against Medical Advice (LAMA)",
          "uuid" : "c4ca0949-bc48-41f5-89c8-f6d78c5f81d3",
          "dataType" : "NA",
          "answers" : [ ],
          "order" : 2.0,
          "active" : true,
          "media" : [ ]
        }, {
          "name" : "Cured and discharged",
          "uuid" : "386053f2-b495-44b6-95ca-bcd52b0282ef",
          "dataType" : "NA",
          "answers" : [ ],
          "order" : 0.0,
          "active" : true,
          "media" : [ ]
        }, {
          "name" : "Defaulter",
          "uuid" : "f9ba64b3-021d-411f-aa1c-84ae82f79047",
          "dataType" : "NA",
          "answers" : [ ],
          "order" : 3.0,
          "active" : true,
          "media" : [ ]
        } ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 12.0,
      "type" : "SingleSelect",
      "rule" : "'use strict';\n({params, imports}) => {\n  const programEncounter = params.entity;\n  const moment = imports.moment;\n  const formElement = params.formElement;\n  const _ = imports.lodash;\n  let visibility = true;\n  let value = null;\n  let answersToSkip = [];\n  let validationErrors = [];\n  \n  const oldDate = moment(programEncounter.maxVisitDateTime);\n  const currentDate = moment();\n  \n  if (currentDate.isAfter(oldDate)) {\n    validationErrors.push(\"Overdue forms cannot be filled, please cancel this form so that next due form can be scheduled\");\n  }\n  \n  return new imports.rulesConfig.FormElementStatus(formElement.uuid, visibility, value, answersToSkip, validationErrors);\n};",
      "mandatory" : true
    }, {
      "name" : "Height at discharge",
      "uuid" : "a9de6509-52e0-4d6c-9d1e-2e1fb2158035",
      "keyValues" : [ ],
      "concept" : {
        "name" : "Height at Discharge",
        "uuid" : "3ac094e8-347e-499b-911c-f6a386fca98a",
        "dataType" : "Numeric",
        "answers" : [ ],
        "lowAbsolute" : 40.0,
        "highAbsolute" : 150.0,
        "lowNormal" : 40.0,
        "highNormal" : 150.0,
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 13.0,
      "type" : "SingleSelect",
      "rule" : "'use strict';\n({params, imports}) => {\n  const programEncounter = params.entity;\n  const moment = imports.moment;\n  const formElement = params.formElement;\n  const _ = imports.lodash;\n  let visibility = true;\n  let value = null;\n  let answersToSkip = [];\n  let validationErrors = [];\n  \n  const condition11 = new imports.rulesConfig.RuleCondition({programEncounter, formElement}).when.valueInEncounter(\"398ccb8f-e97c-44de-a7d3-731771a10733\").defined.and.when.valueInEncounter(\"398ccb8f-e97c-44de-a7d3-731771a10733\").containsAnswerConceptNameOtherThan(\"c4ca0949-bc48-41f5-89c8-f6d78c5f81d3\").and.when.valueInEncounter(\"398ccb8f-e97c-44de-a7d3-731771a10733\").containsAnswerConceptNameOtherThan(\"f9ba64b3-021d-411f-aa1c-84ae82f79047\").matches();\n  \n  visibility = condition11 ;\n  \n  let heightAtNrcDischarge = programEncounter.getObservationValue(\"3ac094e8-347e-499b-911c-f6a386fca98a\");\n  let heightAtNrcAdmission = programEncounter.programEnrolment.findLatestObservationFromEncounters(\"0097b1d2-a803-4fc4-a44d-d35436e9637c\",programEncounter).getReadableValue();\n\n      \n    if(heightAtNrcAdmission > heightAtNrcDischarge){\n        validationErrors.push(\"Height at discharge cannot be less than height at admission\");\n    }\n  \n  return new imports.rulesConfig.FormElementStatus(formElement.uuid, visibility, value, answersToSkip, validationErrors);\n};",
      "mandatory" : true
    }, {
      "name" : "Weight at discharge",
      "uuid" : "80d4c2b0-c19a-4d7e-9309-20ad0de908cf",
      "keyValues" : [ ],
      "concept" : {
        "name" : "Weight at Discharge",
        "uuid" : "06e4633a-70ae-4b6e-b570-3dc4056c8a40",
        "dataType" : "Numeric",
        "answers" : [ ],
        "lowAbsolute" : 1.0,
        "highAbsolute" : 50.0,
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 14.0,
      "type" : "SingleSelect",
      "rule" : "'use strict';\n({params, imports}) => {\n  const programEncounter = params.entity;\n  const moment = imports.moment;\n  const formElement = params.formElement;\n  const _ = imports.lodash;\n  let visibility = true;\n  let value = null;\n  let answersToSkip = [];\n  let validationErrors = [];\n  \n  const condition11 = new imports.rulesConfig.RuleCondition({programEncounter, formElement}).when.valueInEncounter(\"398ccb8f-e97c-44de-a7d3-731771a10733\").defined.and.when.valueInEncounter(\"398ccb8f-e97c-44de-a7d3-731771a10733\").containsAnswerConceptNameOtherThan(\"c4ca0949-bc48-41f5-89c8-f6d78c5f81d3\").and.when.valueInEncounter(\"398ccb8f-e97c-44de-a7d3-731771a10733\").containsAnswerConceptNameOtherThan(\"f9ba64b3-021d-411f-aa1c-84ae82f79047\").matches();\n  \n  visibility = condition11 ;\n  \n  return new imports.rulesConfig.FormElementStatus(formElement.uuid, visibility, value, answersToSkip, validationErrors);\n};",
      "mandatory" : true
    }, {
      "name" : "Nutrition status at the time of discharge",
      "uuid" : "7d6be17c-99c1-4e9f-837d-5c4b896c50f2",
      "keyValues" : [ ],
      "concept" : {
        "name" : "Nutrition status at the time of discharge",
        "uuid" : "0eb15bc4-c184-4f2b-a3a2-26170fc0d414",
        "dataType" : "Coded",
        "answers" : [ {
          "name" : "SAM",
          "uuid" : "7d0229c1-e69e-4cac-8937-cdd48c8ed9dd",
          "dataType" : "NA",
          "answers" : [ ],
          "order" : 0.0,
          "active" : true,
          "media" : [ ]
        }, {
          "name" : "MAM",
          "uuid" : "da518460-f4ab-4fcb-89ae-3526619d43c5",
          "dataType" : "NA",
          "answers" : [ ],
          "order" : 1.0,
          "active" : true,
          "media" : [ ]
        } ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 15.0,
      "type" : "SingleSelect",
      "voided" : true,
      "mandatory" : true
    }, {
      "name" : "Nutrition status at the time of discharge",
      "uuid" : "eb32bd7e-8dcb-4cac-a9d9-7bc21713478e",
      "keyValues" : [ {
        "key" : "editable",
        "value" : false
      } ],
      "concept" : {
        "name" : "Nutrition status-discharge",
        "uuid" : "81e3c0fa-e96a-4cd2-8c09-4ae3c126874e",
        "dataType" : "Text",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 16.0,
      "type" : "SingleSelect",
      "rule" : "'use strict';\n({params, imports}) => {\n  const programEncounter = params.entity;\n  const moment = imports.moment;\n  const formElement = params.formElement;\n  const _ = imports.lodash;\n  let visibility = true;\n  let value = null;\n  let answersToSkip = [];\n  let validationErrors = [];\n  \n  \n  const condition11 = new imports.rulesConfig.RuleCondition({programEncounter, formElement}).when.valueInEncounter(\"398ccb8f-e97c-44de-a7d3-731771a10733\").defined.and.when.valueInEncounter(\"398ccb8f-e97c-44de-a7d3-731771a10733\").containsAnswerConceptNameOtherThan(\"c4ca0949-bc48-41f5-89c8-f6d78c5f81d3\").and.when.valueInEncounter(\"398ccb8f-e97c-44de-a7d3-731771a10733\").containsAnswerConceptNameOtherThan(\"f9ba64b3-021d-411f-aa1c-84ae82f79047\").matches();\n  \n  visibility = condition11 ;\n  \n  if(visibility){\n        const height = programEncounter.getObservationValue(\"Height at Discharge\");\n    const weight = programEncounter.getObservationValue(\"Weight at Discharge\");\n    const asOnDate = programEncounter.encounterDateTime;\n    const individual = programEncounter.programEnrolment.individual;\n    const age = programEncounter.programEnrolment.individual.getAgeInMonths();\n\n    const addIfRequired = (decisions, name, value) => {\n        if (value === -0) value = 0;\n        if (value !== undefined) decisions.push({name: name, value: value});\n    };\n\n    const getGradeforZscore = (zScore) => {\n        let grade;\n        if (zScore <= -3) {\n            grade = 3;\n        } else if (zScore > -3 && zScore < -2) {\n            grade = 2;\n        } else if (zScore >= -2) {\n            grade = 1;\n        }\n        return grade;\n    };\n\n    const zScoresForChild = ruleServiceLibraryInterfaceForSharingModules.common.getZScore(individual, asOnDate, weight, height);\n\n    const zScoreGradeStatusMappingWeightForHeight = [\n        [\"SAM\", -3],\n        [\"MAM\", -2],\n        [\"Normal\", 1],\n        [\"Normal\", 2],\n        [\"Normal\", 3],\n        [\"Normal\", Infinity],\n    ];\n\n    const weightForHeightStatus = function (zScore) {\n        let found = _.find(zScoreGradeStatusMappingWeightForHeight, function (currentStatus) {\n            return zScore <= currentStatus[1];\n        });\n        return found && found[0];\n    };\n\n    const wfhStatus = weightForHeightStatus(zScoresForChild.wfh);\n    const wfhGrade = getGradeforZscore(zScoresForChild.wfh);\n    \n    value = wfhStatus;\n  }\n  \n\n  \n  return new imports.rulesConfig.FormElementStatus(formElement.uuid, visibility, value, answersToSkip, validationErrors);\n};",
      "mandatory" : false
    }, {
      "name" : "Date of discharge/left from NRC",
      "uuid" : "d9bab02f-080c-4f5a-9485-4aea8f5e4032",
      "keyValues" : [ ],
      "concept" : {
        "name" : "Date of discharge from NRC",
        "uuid" : "71e84ef3-4f1d-4814-84fc-3672b3a72423",
        "dataType" : "Date",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 17.0,
      "type" : "SingleSelect",
      "rule" : "'use strict';\n({params, imports}) => {\n  const programEncounter = params.entity;\n  const moment = imports.moment;\n  const formElement = params.formElement;\n  const _ = imports.lodash;\n  let visibility = true;\n  let value = null;\n  let answersToSkip = [];\n  let validationErrors = [];\n  \n  const condition11 = new imports.rulesConfig.RuleCondition({programEncounter, formElement}).when.valueInEncounter(\"398ccb8f-e97c-44de-a7d3-731771a10733\").defined.and.when.valueInEncounter(\"398ccb8f-e97c-44de-a7d3-731771a10733\").containsAnswerConceptNameOtherThan(\"c4ca0949-bc48-41f5-89c8-f6d78c5f81d3\").and.when.valueInEncounter(\"398ccb8f-e97c-44de-a7d3-731771a10733\").containsAnswerConceptNameOtherThan(\"f9ba64b3-021d-411f-aa1c-84ae82f79047\").matches();\n  \n  visibility = condition11 ;\n  \n  let selectedDate = programEncounter.getObservationValue('71e84ef3-4f1d-4814-84fc-3672b3a72423');\n  let dateOfAdmission = programEncounter.programEnrolment.findLatestObservationFromEncounters(\"27d927f3-39e2-49d9-8609-bb8aa49a00ec\",programEncounter);\n\n\n  if(selectedDate && dateOfAdmission) {\n    \n    const currentDate = moment().startOf('day');\n    selectedDate = moment(selectedDate).startOf('day');\n    dateOfAdmission = moment(dateOfAdmission.getValue()).startOf('day');\n    \n     if (selectedDate.isAfter(currentDate)) {\n      validationErrors.push(\"Invalid date: Future dates are not allowed.\");\n    }\n    \n    if (selectedDate.isBefore(dateOfAdmission)) {\n      validationErrors.push(\"Invalid date: Selected date cannot be earlier than the date of admission.\");\n    }\n}\n  \n  return new imports.rulesConfig.FormElementStatus(formElement.uuid, visibility, value, answersToSkip, validationErrors);\n};",
      "mandatory" : true
    }, {
      "name" : "Criteria for exit",
      "uuid" : "5a49fb64-32fe-425f-b492-4525d9ce8165",
      "keyValues" : [ ],
      "concept" : {
        "name" : "Criteria for exit",
        "uuid" : "f0ac307d-7487-4d2a-92c9-5d3574a5b9e3",
        "dataType" : "Coded",
        "answers" : [ {
          "name" : "Weight for height",
          "uuid" : "086a8367-37de-4daa-b242-9d83ee814853",
          "dataType" : "NA",
          "answers" : [ ],
          "order" : 0.0,
          "active" : true,
          "media" : [ ]
        }, {
          "name" : "Other medical complication",
          "uuid" : "97381570-77b1-4cb6-8c4b-7509f097d956",
          "dataType" : "NA",
          "answers" : [ ],
          "order" : 2.0,
          "active" : true,
          "media" : [ ]
        }, {
          "name" : "MUAC",
          "uuid" : "e42f6cc7-125b-4836-9d04-22a3523ac7d4",
          "dataType" : "NA",
          "answers" : [ ],
          "order" : 1.0,
          "active" : true,
          "media" : [ ]
        } ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 18.0,
      "type" : "SingleSelect",
      "rule" : "'use strict';\n({params, imports}) => {\n  const programEncounter = params.entity;\n  const moment = imports.moment;\n  const formElement = params.formElement;\n  const _ = imports.lodash;\n  let visibility = true;\n  let value = null;\n  let answersToSkip = [];\n  let validationErrors = [];\n  \n  const condition11 = new imports.rulesConfig.RuleCondition({programEncounter, formElement}).when.valueInEncounter(\"398ccb8f-e97c-44de-a7d3-731771a10733\").defined.and.when.valueInEncounter(\"398ccb8f-e97c-44de-a7d3-731771a10733\").containsAnswerConceptNameOtherThan(\"c4ca0949-bc48-41f5-89c8-f6d78c5f81d3\").and.when.valueInEncounter(\"398ccb8f-e97c-44de-a7d3-731771a10733\").containsAnswerConceptNameOtherThan(\"f9ba64b3-021d-411f-aa1c-84ae82f79047\").matches();\n  \n  visibility = condition11 ;\n  \n  return new imports.rulesConfig.FormElementStatus(formElement.uuid, visibility, value, answersToSkip, validationErrors);\n};",
      "mandatory" : true
    }, {
      "name" : "Other medical complication, please specify",
      "uuid" : "9c4b4fe0-dfeb-4e0e-b4c7-f42682f92b12",
      "keyValues" : [ ],
      "concept" : {
        "name" : "Other medical complication, please specify",
        "uuid" : "44c3706d-94ca-44ab-a7cf-ff54c43dfab9",
        "dataType" : "Text",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 19.0,
      "type" : "SingleSelect",
      "rule" : "'use strict';\n({params, imports}) => {\n  const programEncounter = params.entity;\n  const moment = imports.moment;\n  const formElement = params.formElement;\n  const _ = imports.lodash;\n  let visibility = true;\n  let value = null;\n  let answersToSkip = [];\n  let validationErrors = [];\n  \n  const condition11 = new imports.rulesConfig.RuleCondition({programEncounter, formElement}).when.valueInEncounter(\"f0ac307d-7487-4d2a-92c9-5d3574a5b9e3\").containsAnswerConceptName(\"97381570-77b1-4cb6-8c4b-7509f097d956\").matches();\n  \n  visibility = condition11 ;\n  \n  return new imports.rulesConfig.FormElementStatus(formElement.uuid, visibility, value, answersToSkip, validationErrors);\n};",
      "declarativeRule" : [ {
        "actions" : [ {
          "actionType" : "showFormElement"
        }, { } ],
        "conditions" : [ {
          "compoundRule" : {
            "rules" : [ {
              "lhs" : {
                "type" : "concept",
                "scope" : "encounter",
                "conceptName" : "Criteria for exit",
                "conceptUuid" : "f0ac307d-7487-4d2a-92c9-5d3574a5b9e3",
                "conceptDataType" : "Coded"
              },
              "rhs" : {
                "type" : "answerConcept",
                "answerConceptNames" : [ "Other medical complication" ],
                "answerConceptUuids" : [ "97381570-77b1-4cb6-8c4b-7509f097d956" ]
              },
              "operator" : "containsAnswerConceptName"
            } ]
          }
        } ]
      } ],
      "mandatory" : false
    } ],
    "display" : "Discharge Details",
    "timed" : false
  } ],
  "decisionRule" : "",
  "visitScheduleRule" : "\"use strict\";\n({ params, imports }) => {\n  const programEncounter = params.entity;\n  const moment = imports.moment;\n  const scheduleBuilder = new imports.rulesConfig.VisitScheduleBuilder({programEncounter});\n  \n  const isDateOfDischargeDefined = new imports.rulesConfig.RuleCondition({programEncounter}).when.valueInEncounter(\"71e84ef3-4f1d-4814-84fc-3672b3a72423\").defined.matches();\n  \n  const isChildHomeVisitAlreadyScheduled = programEncounter.programEnrolment.getEncounters()\n  .some( enc => enc.encounterType.name === 'Child Home Visit' && enc.name === 'Child Home Visit - Post NRC' && !enc.encounterDateTime && !enc.cancelDateTime )\n  \n  if(isDateOfDischargeDefined && !isChildHomeVisitAlreadyScheduled){\n    const earliestDate = moment(programEncounter.getObservationReadableValue('71e84ef3-4f1d-4814-84fc-3672b3a72423')).add(15, 'days').startOf('day').toDate();\n    const maxDate = moment(earliestDate).add(7, 'days').endOf('day').toDate();\n    scheduleBuilder.add({name: \"Child Home Visit - Post NRC\", encounterType: \"Child Home Visit\", earliestDate, maxDate, visitCreationStrategy: \"createNew\"});  \n  }\n  \n  return scheduleBuilder.getAll();\n \n};",
  "validationRule" : "'use strict';\n({params, imports}) => {\n    const programEncounter = params.entity;\n    const moment = imports.moment;\n    const validationResults = [];\n\n    // Get schedule date (earliest visit date)\n    const scheduleDate = programEncounter.earliestVisitDateTime;\n\n    // Check if encounter date is before schedule month\n    const isBeforeScheduleMonth = moment(programEncounter.encounterDateTime)\n        .isBefore(moment(scheduleDate).startOf('month'));\n\n    // Check if encounter date is after schedule month\n    const isAfterScheduleMonth = moment(programEncounter.encounterDateTime)\n        .isAfter(moment(scheduleDate).endOf('month'));\n\n   // if (isBeforeScheduleMonth) {\n   //     validationResults.push(imports.common.createValidationError(\"Cannot fill this form before the scheduled month, Please fill this form in scheduled month\"));\n  //  }\n\n  //  if (isAfterScheduleMonth) {\n   //     validationResults.push(imports.common.createValidationError(\"Cannot fill this form after the scheduled month\"));\n  //  }\n\n\n    return validationResults;\n};\n",
  "checklistsRule" : "",
  "decisionConcepts" : [ ]
}