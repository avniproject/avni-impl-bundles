{
  "name" : "Follow Up Letter Encounter",
  "uuid" : "719da22b-286e-4d4c-9776-114d5d3522cd",
  "formType" : "ProgramEncounter",
  "formElementGroups" : [ {
    "uuid" : "bee9a7f2-be20-4d62-af02-f44c6e1d29a2",
    "name" : "Letter Details",
    "displayOrder" : 1.0,
    "formElements" : [ {
      "name" : "Date of Posting",
      "uuid" : "cf5fb825-0edc-42d6-808f-7313d363d16e",
      "keyValues" : [ {
        "key" : "datePickerMode",
        "value" : "calendar"
      } ],
      "concept" : {
        "name" : "Date of Posting",
        "uuid" : "3541ec56-6082-47dd-8761-2abdfbe30399",
        "dataType" : "Date",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 1.0,
      "type" : "SingleSelect",
      "rule" : "//SAMPLE RULE EXAMPLE\n'use strict';\n({params, imports}) => {\n  const programEncounter = params.entity;\n  const moment = imports.moment;\n  const formElement = params.formElement;\n  const _ = imports.lodash;\n  let visibility = true;\n  let value = null;\n  let answersToSkip = [];\n  let validationErrors = [];\n  \n  let selectedDate = programEncounter.getObservationValue('3541ec56-6082-47dd-8761-2abdfbe30399');\n\n    if(selectedDate) {\n      \n      const currentDate = moment().startOf('day');\n      selectedDate = moment(selectedDate).startOf('day');\n      if(selectedDate.isAfter(currentDate)){\n          validationErrors.push(\"Invalid date: Future dates are not allowed\");\n      }\n    }\n  \n  return new imports.rulesConfig.FormElementStatus(formElement.uuid, visibility, value, answersToSkip, validationErrors);\n};",
      "mandatory" : true
    }, {
      "name" : "Applicant Name",
      "uuid" : "20e5c10e-3d74-4c7b-95a6-bf0a9e5041a7",
      "keyValues" : [ ],
      "concept" : {
        "name" : "Applicant Name",
        "uuid" : "2fb481ce-48a1-4be2-80a3-3f3b388b4980",
        "dataType" : "Text",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 2.0,
      "type" : "SingleSelect",
      "mandatory" : true
    }, {
      "name" : "Subject matter of letter",
      "uuid" : "1bcf1a8d-4415-4739-9e7d-0d15bf915a65",
      "keyValues" : [ ],
      "concept" : {
        "name" : "Subject Matter of Letter",
        "uuid" : "0e7ba322-974f-49f0-9969-325dd8d976b7",
        "dataType" : "Text",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 3.0,
      "type" : "SingleSelect",
      "mandatory" : true
    }, {
      "name" : "Posted to (Name of Authority)",
      "uuid" : "e42f3338-cecb-4e26-a546-02f959d2108c",
      "keyValues" : [ ],
      "concept" : {
        "name" : "Posted to (Name of Authority)",
        "uuid" : "7e756501-1ec8-4b5c-a2a2-38862321c0c3",
        "dataType" : "Text",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 4.0,
      "type" : "SingleSelect",
      "mandatory" : true
    }, {
      "name" : "Date of receipt by authority",
      "uuid" : "ea5855da-4178-4ea0-820d-edf61b833717",
      "keyValues" : [ {
        "key" : "datePickerMode",
        "value" : "calendar"
      } ],
      "concept" : {
        "name" : "Date of receipt by Authority",
        "uuid" : "135fa3f5-af03-43aa-8cc7-26bb42ff7ce0",
        "dataType" : "Date",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 5.0,
      "type" : "SingleSelect",
      "rule" : "//SAMPLE RULE EXAMPLE\n'use strict';\n({params, imports}) => {\n  const programEncounter = params.entity;\n  const moment = imports.moment;\n  const formElement = params.formElement;\n  const _ = imports.lodash;\n  let visibility = true;\n  let value = null;\n  let answersToSkip = [];\n  let validationErrors = [];\n  \n  let dateOfPosting = programEncounter.getObservationValue('3541ec56-6082-47dd-8761-2abdfbe30399');\n  let receiptDate = programEncounter.getObservationValue('135fa3f5-af03-43aa-8cc7-26bb42ff7ce0');\n\n    if(receiptDate) {\n      dateOfPosting = moment(dateOfPosting).startOf('day');\n      receiptDate = moment(receiptDate).startOf('day');\n      if(dateOfPosting.isAfter(receiptDate)){\n          validationErrors.push(\"Invalid date: Date of receipt should be more than Date of posting\");\n      }\n    }\n  \n  return new imports.rulesConfig.FormElementStatus(formElement.uuid, visibility, value, answersToSkip, validationErrors);\n};\n",
      "mandatory" : false
    }, {
      "name" : "Date of response",
      "uuid" : "6010b52b-881d-451c-ad9e-ab7d73a7f66c",
      "keyValues" : [ {
        "key" : "datePickerMode",
        "value" : "calendar"
      } ],
      "concept" : {
        "name" : "Date Of response",
        "uuid" : "dc965e77-f3f3-4310-a3d0-65bcb90019ce",
        "dataType" : "Date",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 6.0,
      "type" : "SingleSelect",
      "rule" : "//SAMPLE RULE EXAMPLE\n'use strict';\n({params, imports}) => {\n  const programEncounter = params.entity;\n  const moment = imports.moment;\n  const formElement = params.formElement;\n  const _ = imports.lodash;\n  let visibility = true;\n  let value = null;\n  let answersToSkip = [];\n  let validationErrors = [];\n  \n  let receiptDate = programEncounter.getObservationValue('135fa3f5-af03-43aa-8cc7-26bb42ff7ce0');\n  let dateOfResponse = programEncounter.getObservationValue('dc965e77-f3f3-4310-a3d0-65bcb90019ce');\n\n    if(dateOfResponse) {\n      receiptDate = moment(receiptDate).startOf('day');\n      dateOfResponse = moment(dateOfResponse).startOf('day');\n      if(receiptDate.isAfter(dateOfResponse)){\n          validationErrors.push(\"Invalid date: Date of response Should be more than date of receipt\");\n      }\n    }\n  \n  return new imports.rulesConfig.FormElementStatus(formElement.uuid, visibility, value, answersToSkip, validationErrors);\n};",
      "mandatory" : false
    } ],
    "display" : "Letter Details",
    "timed" : false
  } ],
  "decisionRule" : "\"use strict\";\n({params, imports}) => {\n    const programEncounter = params.entity;\n    const decisions = params.decisions;\n    const moment = imports.moment;\n    const encounterDecisions = [];\n    \n    const encounterDateForEditCase = programEncounter.getObservationValue(\"1f4bc226-9e3f-42c9-a332-2d81cd8e64f7\");\n    \n    if (!encounterDateForEditCase) {\n      let encDateTime = moment().format(\"YYYY-MM-DD HH:mm:ss\");\n      \n      if (encDateTime) {\n        encounterDecisions.push({ name: \"Encounter DateTime\", value: encDateTime });\n      }\n      decisions.encounterDecisions.push(...encounterDecisions);\n    }\n    return decisions;\n};",
  "visitScheduleRule" : "",
  "validationRule" : "'use strict';\n({params, imports}) => {\n  const programEncounter = params.entity;\n  const validationResults = [];\n  const moment = imports.moment;\n  \n  const encounterDateForEditCase = programEncounter.getObservationValue(\"1f4bc226-9e3f-42c9-a332-2d81cd8e64f7\");\n  const encounterDate = programEncounter.encounterDateTime;\n\n  if (!encounterDateForEditCase) {\n    if (encounterDate) {\n      const today = moment().startOf('day');\n      const encDate = moment(encounterDate).startOf('day');\n\n      if (!encDate.isSame(today, 'day')) {\n        validationResults.push(\n          imports.common.createValidationError(\"Encounter Date should be today's date.\")\n        );\n      }\n    }\n  } else {\n    const encDateEdit = moment(encounterDate).startOf('day');\n    const encDateOriginal = moment(encounterDateForEditCase).startOf('day');\n\n    if (!encDateEdit.isSame(encDateOriginal, 'day')) {\n      validationResults.push(\n        imports.common.createValidationError(\"Encounter Date cannot be changed.\")\n      );\n    }\n  }\n  \n  return validationResults;\n};",
  "checklistsRule" : "",
  "decisionConcepts" : [ ]
}