{
  "name" : "Claim Legal Fund",
  "uuid" : "4754a916-625d-45e1-965f-4daacece9215",
  "formType" : "Encounter",
  "formElementGroups" : [ {
    "uuid" : "7fbbb084-6b18-4d95-9a04-f666b35ec606",
    "name" : "Legal Fund Details",
    "displayOrder" : 1.0,
    "formElements" : [ {
      "name" : "Fill details of the legal fund received",
      "uuid" : "96afc7c4-17a9-429c-ab42-6f6a3cbbc1cb",
      "keyValues" : [ {
        "key" : "repeatable",
        "value" : true
      } ],
      "concept" : {
        "name" : "LEGAL FUND ENCOUNTER",
        "uuid" : "22a96d47-8121-455b-b5e0-8fa7c5da1c4e",
        "dataType" : "QuestionGroup",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 1.0,
      "type" : "SingleSelect",
      "mandatory" : false
    }, {
      "name" : "Date of Receipt",
      "uuid" : "6aac9be8-1510-45f5-b54d-394479c10694",
      "keyValues" : [ {
        "key" : "datePickerMode",
        "value" : "calendar"
      } ],
      "concept" : {
        "name" : "Date of receipt - Legal Fund (voided~266436)",
        "uuid" : "d2869f1e-4e6c-4b5c-815d-1d96a08889cd",
        "dataType" : "Date",
        "answers" : [ ],
        "active" : true,
        "media" : [ ],
        "voided" : true
      },
      "displayOrder" : 2.0,
      "type" : "SingleSelect",
      "rule" : "'use strict';\n({ params, imports }) => {\n    const encounter = params.entity;\n    const moment = imports.moment;\n    const formElement = params.formElement;\n    const _ = imports.lodash;\n\n    let visibility = true;\n    let value = null;\n    let answersToSkip = [];\n    let validationErrors = [];\n    const questionGroupIndex = params.questionGroupIndex;\n\n    const questionGroup = encounter.getObservationValue(\"22a96d47-8121-455b-b5e0-8fa7c5da1c4e\");\n    if(questionGroup){\n        const currentQuestionGroup = questionGroup[questionGroupIndex];\n       \n        if(currentQuestionGroup){\n            let dateofReceipt = currentQuestionGroup.findObservationByConceptUUID(\"d2869f1e-4e6c-4b5c-815d-1d96a08889cd\");\n        \n            if(dateofReceipt){\n                const currentDate = moment().startOf(\"day\");\n                dateofReceipt = moment(dateofReceipt.getValue()).startOf(\"day\");\n                if (dateofReceipt.isAfter(currentDate)) {\n                    validationErrors.push(\"Invalid date: Future dates are not allowed\");\n                }\n            }\n            else{\n                value = moment().startOf(\"day\");\n            }\n        }\n        else{\n            value = moment().startOf(\"day\");\n        }\n    }\n    else{\n        value = moment().startOf(\"day\");\n    }\n    \n    return new imports.rulesConfig.FormElementStatus(formElement.uuid, visibility, value, answersToSkip, validationErrors);\n};",
      "parentFormElementUuid" : "96afc7c4-17a9-429c-ab42-6f6a3cbbc1cb",
      "voided" : true,
      "mandatory" : true
    }, {
      "name" : "Date of Receipt",
      "uuid" : "8bdcd1b8-95cc-4dae-8147-77b4277f28d4",
      "keyValues" : [ {
        "key" : "datePickerMode",
        "value" : "calendar"
      } ],
      "concept" : {
        "name" : "Date of receipt",
        "uuid" : "c329c903-d7cd-4378-adae-b2b99eb2311f",
        "dataType" : "Date",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 3.0,
      "type" : "SingleSelect",
      "rule" : "'use strict';\n({ params, imports }) => {\n    const encounter = params.entity;\n    const moment = imports.moment;\n    const formElement = params.formElement;\n    const _ = imports.lodash;\n\n    let visibility = true;\n    let value = null;\n    let answersToSkip = [];\n    let validationErrors = [];\n    const questionGroupIndex = params.questionGroupIndex;\n\n    const questionGroup = encounter.getObservationValue(\"22a96d47-8121-455b-b5e0-8fa7c5da1c4e\");\n    if(questionGroup){\n        const currentQuestionGroup = questionGroup[questionGroupIndex];\n       \n        if(currentQuestionGroup){\n            let dateofReceipt = currentQuestionGroup.findObservationByConceptUUID(\"c329c903-d7cd-4378-adae-b2b99eb2311f\");\n        \n            if(dateofReceipt){\n                const currentDate = moment().startOf(\"day\");\n                dateofReceipt = moment(dateofReceipt.getValue()).startOf(\"day\");\n                if (dateofReceipt.isAfter(currentDate)) {\n                    validationErrors.push(\"Invalid date: Future dates are not allowed\");\n                }\n            }\n            else{\n                value = moment().startOf(\"day\");\n            }\n        }\n        else{\n            value = moment().startOf(\"day\");\n        }\n    }\n    else{\n        value = moment().startOf(\"day\");\n    }\n    \n    return new imports.rulesConfig.FormElementStatus(formElement.uuid, visibility, value, answersToSkip, validationErrors);\n};",
      "parentFormElementUuid" : "96afc7c4-17a9-429c-ab42-6f6a3cbbc1cb",
      "mandatory" : true
    }, {
      "name" : "Amount",
      "uuid" : "b9a73502-8687-48fd-8663-141196868442",
      "keyValues" : [ ],
      "concept" : {
        "name" : "Amount - Legal Fund",
        "uuid" : "498f42be-21dc-4b03-a2ed-5761d327583f",
        "dataType" : "Numeric",
        "answers" : [ ],
        "lowAbsolute" : 0.0,
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 4.0,
      "type" : "SingleSelect",
      "rule" : "",
      "parentFormElementUuid" : "96afc7c4-17a9-429c-ab42-6f6a3cbbc1cb",
      "mandatory" : true
    }, {
      "name" : "Stage at which taken",
      "uuid" : "e73a709b-5a93-4aba-95f7-3a4afa1be4d7",
      "keyValues" : [ ],
      "concept" : {
        "name" : "Stage at which Taken",
        "uuid" : "02a93e4e-1ce1-42d0-9c08-89baf75ea6d5",
        "dataType" : "Text",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 5.0,
      "type" : "SingleSelect",
      "parentFormElementUuid" : "96afc7c4-17a9-429c-ab42-6f6a3cbbc1cb",
      "mandatory" : true
    }, {
      "name" : "Upload File",
      "uuid" : "157f1ea9-82fc-4c33-bb38-0a3b856b194b",
      "keyValues" : [ {
        "key" : "allowedMaxSize",
        "value" : 1
      } ],
      "concept" : {
        "name" : "Upload receipt",
        "uuid" : "8eabb8c2-7708-471a-a0aa-c7dc549ad006",
        "dataType" : "File",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 6.0,
      "type" : "SingleSelect",
      "parentFormElementUuid" : "96afc7c4-17a9-429c-ab42-6f6a3cbbc1cb",
      "mandatory" : false
    }, {
      "name" : "Upload receipt",
      "uuid" : "14078e20-f103-4510-9db4-a19d5362ed72",
      "keyValues" : [ {
        "key" : "allowedMaxSize",
        "value" : 1
      } ],
      "concept" : {
        "name" : "Upload receipt - Legal Fund",
        "uuid" : "46c5bfa8-4d88-4b69-b7c1-5b1b78ae99a3",
        "dataType" : "File",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 7.0,
      "type" : "SingleSelect",
      "parentFormElementUuid" : "96afc7c4-17a9-429c-ab42-6f6a3cbbc1cb",
      "voided" : true,
      "mandatory" : false
    }, {
      "name" : "Upload Image",
      "uuid" : "3cada334-b5a6-4ebd-9c47-8fa2253c3e5b",
      "keyValues" : [ ],
      "concept" : {
        "name" : "Upload Image",
        "uuid" : "fe30a8b6-0c79-4fb6-988a-4f2a717a8fbe",
        "dataType" : "Image",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 8.0,
      "type" : "SingleSelect",
      "parentFormElementUuid" : "96afc7c4-17a9-429c-ab42-6f6a3cbbc1cb",
      "mandatory" : false
    } ],
    "display" : "Legal Fund Details",
    "timed" : false
  } ],
  "decisionRule" : "\"use strict\";\n({params, imports}) => {\n    const encounter = params.entity;\n    const decisions = params.decisions;\n    const moment = imports.moment;\n    const encounterDecisions = [];\n    \n    const encounterDateForEditCase = encounter.getObservationValue(\"1f4bc226-9e3f-42c9-a332-2d81cd8e64f7\");\n    \n    if (!encounterDateForEditCase) {\n      let encDateTime = moment().format(\"YYYY-MM-DD HH:mm:ss\");\n      \n      if (encDateTime) {\n        encounterDecisions.push({ name: \"Encounter DateTime\", value: encDateTime });\n      }\n      decisions.encounterDecisions.push(...encounterDecisions);\n    }\n    \n    return decisions;\n};",
  "visitScheduleRule" : "",
  "validationRule" : "'use strict';\n({params, imports}) => {\n  const programEncounter = params.entity;\n  const validationResults = [];\n  const formElement = params.formElement;\n  const _ = imports.lodash;\n  let validationErrors = [];\n  const moment = imports.moment;\n  \n  let documentDetails = programEncounter.findGroupedObservation(\"22a96d47-8121-455b-b5e0-8fa7c5da1c4e\");\n  if(documentDetails && documentDetails.length > 0){\n    for(let i = 0;i<documentDetails.length;i++){\n      let currentQuestionGroup = documentDetails[i]\n      let uploadFile = currentQuestionGroup.findObservationByConceptUUID(\"8eabb8c2-7708-471a-a0aa-c7dc549ad006\");\n      let uploadImage =  currentQuestionGroup.findObservationByConceptUUID(\"fe30a8b6-0c79-4fb6-988a-4f2a717a8fbe\");\n\n      if((uploadFile === null || uploadFile === undefined) && (uploadImage === null || uploadImage === undefined)){\n        let validationError = imports.common.createValidationError('Please upload either image or file');\n        validationResults.push(validationError);\n      }\n    }\n  }  \n  \n  const encounterDateForEditCase = programEncounter.getObservationValue(\"1f4bc226-9e3f-42c9-a332-2d81cd8e64f7\");\n  const encounterDate = programEncounter.encounterDateTime;\n\n  if (!encounterDateForEditCase) {\n    if (encounterDate) {\n      const today = moment().startOf('day');\n      const encDate = moment(encounterDate).startOf('day');\n\n      if (!encDate.isSame(today, 'day')) {\n        validationResults.push(\n          imports.common.createValidationError(\"Encounter Date should be today's date.\")\n        );\n      }\n    }\n  } else {\n    const encDateEdit = moment(encounterDate).startOf('day');\n    const encDateOriginal = moment(encounterDateForEditCase).startOf('day');\n\n    if (!encDateEdit.isSame(encDateOriginal, 'day')) {\n      validationResults.push(\n        imports.common.createValidationError(\"Encounter Date cannot be changed.\")\n      );\n    }\n  }\n  \n  return validationResults;\n};\n",
  "checklistsRule" : "",
  "decisionConcepts" : [ ]
}