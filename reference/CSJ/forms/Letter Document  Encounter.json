{
  "name" : "Letter Document  Encounter",
  "uuid" : "60f228b7-9d84-4a58-b352-6c00f7473ee9",
  "formType" : "ProgramEncounter",
  "formElementGroups" : [ {
    "uuid" : "1f33200b-2c9e-49cf-897c-5984b3013214",
    "name" : "Document",
    "displayOrder" : 1.0,
    "formElements" : [ {
      "name" : "Letter Document Details",
      "uuid" : "9d7da93a-3116-4062-8b24-776ded4b0e04",
      "keyValues" : [ ],
      "concept" : {
        "name" : "Letter Document Details",
        "uuid" : "26746aea-5579-4394-ae1c-ac6bfe2c8370",
        "dataType" : "QuestionGroup",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 1.0,
      "type" : "SingleSelect",
      "voided" : true,
      "mandatory" : false
    }, {
      "name" : "Name of Document",
      "uuid" : "46ac7b8b-dfc5-48a4-b58c-2288f43183b9",
      "keyValues" : [ ],
      "concept" : {
        "name" : "Name of Document",
        "uuid" : "84d7e0ad-1cbb-4ac3-a831-4dbd2a89cbb1",
        "dataType" : "Text",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 2.0,
      "type" : "SingleSelect",
      "voided" : true,
      "mandatory" : true
    }, {
      "name" : "Date of Document",
      "uuid" : "caffffb6-4e89-43e3-b39f-27f05f0a6a22",
      "keyValues" : [ {
        "key" : "datePickerMode",
        "value" : "calendar"
      }, {
        "key" : "durationOptions",
        "value" : [ "years", "months", "weeks" ]
      } ],
      "concept" : {
        "name" : "Date of Document",
        "uuid" : "8bb3fd94-f7b2-4b37-aa00-db81833ff379",
        "dataType" : "Date",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 3.0,
      "type" : "SingleSelect",
      "voided" : true,
      "mandatory" : true
    }, {
      "name" : "Upload File",
      "uuid" : "ddb149c5-c11a-46a4-80ae-9cc3cdde589f",
      "keyValues" : [ {
        "key" : "allowedMaxSize",
        "value" : 1
      } ],
      "concept" : {
        "name" : "Upload File for Letter Document",
        "uuid" : "1fe8cc53-8b76-4130-9fb2-7219402dc941",
        "dataType" : "File",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 4.0,
      "type" : "MultiSelect",
      "voided" : true,
      "mandatory" : false
    }, {
      "name" : "Upload Image",
      "uuid" : "603e3ba9-fa0a-4686-9781-2372b984179f",
      "keyValues" : [ ],
      "concept" : {
        "name" : "Upload Image for letter document",
        "uuid" : "01999727-08f9-4d0d-886a-86ab3143ec36",
        "dataType" : "Image",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 5.0,
      "type" : "MultiSelect",
      "voided" : true,
      "mandatory" : false
    }, {
      "name" : "Nature of document",
      "uuid" : "63803e6c-73a4-4b79-bccf-187b3ab2a99e",
      "keyValues" : [ ],
      "concept" : {
        "name" : "Nature of document Letter",
        "uuid" : "82268aa0-df14-4240-bdd8-4b9625ee7511",
        "dataType" : "Coded",
        "answers" : [ {
          "name" : "Letter",
          "uuid" : "266cb87a-87f9-419d-a572-0ec7744118a1",
          "dataType" : "NA",
          "answers" : [ ],
          "order" : 0.0,
          "active" : true,
          "media" : [ ]
        }, {
          "name" : "Follow up Letter",
          "uuid" : "4dd233ab-e56d-40cf-846b-b3dbfeb51e26",
          "dataType" : "NA",
          "answers" : [ ],
          "order" : 1.0,
          "active" : true,
          "media" : [ ]
        }, {
          "name" : "Follow Up RTI",
          "uuid" : "8658f1e9-88b9-4896-aa3a-4fa214c4d3cf",
          "dataType" : "NA",
          "answers" : [ ],
          "order" : 2.0,
          "active" : true,
          "media" : [ ]
        } ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 6.0,
      "type" : "SingleSelect",
      "parentFormElementUuid" : "9d7da93a-3116-4062-8b24-776ded4b0e04",
      "voided" : true,
      "mandatory" : true
    } ],
    "voided" : true,
    "display" : "Document",
    "timed" : false
  }, {
    "uuid" : "c61e12e9-ba6a-4b43-b599-0c925b430c6d",
    "name" : "Documents",
    "displayOrder" : 2.0,
    "formElements" : [ {
      "name" : "Letter Document Details",
      "uuid" : "cd779c05-d113-4ede-ba69-876c414b5b3f",
      "keyValues" : [ {
        "key" : "repeatable",
        "value" : true
      } ],
      "concept" : {
        "name" : "Letter Document Details",
        "uuid" : "26746aea-5579-4394-ae1c-ac6bfe2c8370",
        "dataType" : "QuestionGroup",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 1.0,
      "type" : "SingleSelect",
      "mandatory" : false
    }, {
      "name" : "Nature of document",
      "uuid" : "641f1afb-a0d0-428a-b3a9-e1001bcd1aa1",
      "keyValues" : [ ],
      "concept" : {
        "name" : "Nature of document Letter",
        "uuid" : "82268aa0-df14-4240-bdd8-4b9625ee7511",
        "dataType" : "Coded",
        "answers" : [ {
          "name" : "Letter",
          "uuid" : "266cb87a-87f9-419d-a572-0ec7744118a1",
          "dataType" : "NA",
          "answers" : [ ],
          "order" : 0.0,
          "active" : true,
          "media" : [ ]
        }, {
          "name" : "Follow up Letter",
          "uuid" : "4dd233ab-e56d-40cf-846b-b3dbfeb51e26",
          "dataType" : "NA",
          "answers" : [ ],
          "order" : 1.0,
          "active" : true,
          "media" : [ ]
        }, {
          "name" : "Follow Up RTI",
          "uuid" : "8658f1e9-88b9-4896-aa3a-4fa214c4d3cf",
          "dataType" : "NA",
          "answers" : [ ],
          "order" : 2.0,
          "active" : true,
          "media" : [ ]
        } ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 2.0,
      "type" : "SingleSelect",
      "parentFormElementUuid" : "cd779c05-d113-4ede-ba69-876c414b5b3f",
      "mandatory" : true
    }, {
      "name" : "Name of Document",
      "uuid" : "b3cc2d42-f933-432d-ac09-ab306fc63ea4",
      "keyValues" : [ ],
      "concept" : {
        "name" : "Name of Document",
        "uuid" : "84d7e0ad-1cbb-4ac3-a831-4dbd2a89cbb1",
        "dataType" : "Text",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 3.0,
      "type" : "SingleSelect",
      "parentFormElementUuid" : "cd779c05-d113-4ede-ba69-876c414b5b3f",
      "mandatory" : true
    }, {
      "name" : "Date of Document",
      "uuid" : "93337da2-d38f-4712-aa23-1bb80320a713",
      "keyValues" : [ ],
      "concept" : {
        "name" : "Date of Document",
        "uuid" : "8bb3fd94-f7b2-4b37-aa00-db81833ff379",
        "dataType" : "Date",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 4.0,
      "type" : "SingleSelect",
      "parentFormElementUuid" : "cd779c05-d113-4ede-ba69-876c414b5b3f",
      "mandatory" : true
    }, {
      "name" : "Upload File",
      "uuid" : "ee218d24-594c-4a5a-8bfb-b00f85b8674a",
      "keyValues" : [ {
        "key" : "allowedMaxSize",
        "value" : 1
      } ],
      "concept" : {
        "name" : "Upload File for Letter Document",
        "uuid" : "1fe8cc53-8b76-4130-9fb2-7219402dc941",
        "dataType" : "File",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 5.0,
      "type" : "SingleSelect",
      "parentFormElementUuid" : "cd779c05-d113-4ede-ba69-876c414b5b3f",
      "mandatory" : false
    }, {
      "name" : "Upload Image",
      "uuid" : "e6439b4b-5735-4c30-a594-d7e32f470eed",
      "keyValues" : [ ],
      "concept" : {
        "name" : "Upload Image for letter document",
        "uuid" : "01999727-08f9-4d0d-886a-86ab3143ec36",
        "dataType" : "Image",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 6.0,
      "type" : "SingleSelect",
      "parentFormElementUuid" : "cd779c05-d113-4ede-ba69-876c414b5b3f",
      "mandatory" : false
    } ],
    "display" : "Documents",
    "timed" : false
  } ],
  "decisionRule" : "\"use strict\";\n({params, imports}) => {\n    const programEncounter = params.entity;\n    const decisions = params.decisions;\n    const moment = imports.moment;\n    const encounterDecisions = [];\n    \n    const encounterDateForEditCase = programEncounter.getObservationValue(\"1f4bc226-9e3f-42c9-a332-2d81cd8e64f7\");\n    \n    if (!encounterDateForEditCase) {\n      let encDateTime = moment().format(\"YYYY-MM-DD HH:mm:ss\");\n      \n      if (encDateTime) {\n        encounterDecisions.push({ name: \"Encounter DateTime\", value: encDateTime });\n      }\n      decisions.encounterDecisions.push(...encounterDecisions);\n    }\n    return decisions;\n};",
  "visitScheduleRule" : "",
  "validationRule" : "//SAMPLE RULE EXAMPLE\n'use strict';\n({params, imports}) => {\n  const programEncounter = params.entity;\n  const validationResults = [];\n  const formElement = params.formElement;\n  const _ = imports.lodash;\n  let validationErrors = [];\n  const moment = imports.moment;\n  \n  let documentDetails = programEncounter.findGroupedObservation(\"26746aea-5579-4394-ae1c-ac6bfe2c8370\");\n  if(documentDetails && documentDetails.length > 0){\n    for(let i = 0;i<documentDetails.length;i++){\n      let currentQuestionGroup = documentDetails[i]\n      let uploadFile = currentQuestionGroup.findObservationByConceptUUID(\"1fe8cc53-8b76-4130-9fb2-7219402dc941\");\n      let uploadImage =  currentQuestionGroup.findObservationByConceptUUID(\"01999727-08f9-4d0d-886a-86ab3143ec36\");\n\n\n      if((uploadFile === null || uploadFile === undefined) && (uploadImage === null || uploadImage === undefined)){\n        let validationError = imports.common.createValidationError('Please upload either image or file');\n        validationResults.push(validationError);\n      }\n    }\n  }  \n  \n  const encounterDateForEditCase = programEncounter.getObservationValue(\"1f4bc226-9e3f-42c9-a332-2d81cd8e64f7\");\n  const encounterDate = programEncounter.encounterDateTime;\n\n  if (!encounterDateForEditCase) {\n    if (encounterDate) {\n      const today = moment().startOf('day');\n      const encDate = moment(encounterDate).startOf('day');\n\n      if (!encDate.isSame(today, 'day')) {\n        validationResults.push(\n          imports.common.createValidationError(\"Encounter Date should be today's date.\")\n        );\n      }\n    }\n  } else {\n    const encDateEdit = moment(encounterDate).startOf('day');\n    const encDateOriginal = moment(encounterDateForEditCase).startOf('day');\n\n    if (!encDateEdit.isSame(encDateOriginal, 'day')) {\n      validationResults.push(\n        imports.common.createValidationError(\"Encounter Date cannot be changed.\")\n      );\n    }\n  }\n  \n  return validationResults;\n};",
  "checklistsRule" : "",
  "decisionConcepts" : [ ]
}