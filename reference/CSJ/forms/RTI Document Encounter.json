{
  "name" : "RTI Document Encounter",
  "uuid" : "df1cd5f4-5ea4-4fd5-824f-9743089f88cf",
  "formType" : "ProgramEncounter",
  "formElementGroups" : [ {
    "uuid" : "4244c37b-fe10-41cc-8cb8-a98441c45336",
    "name" : "Document",
    "displayOrder" : 1.0,
    "formElements" : [ {
      "name" : "RTI Document Details",
      "uuid" : "c556c204-4d0e-48ce-86dc-40d097a932dc",
      "keyValues" : [ {
        "key" : "repeatable",
        "value" : true
      } ],
      "concept" : {
        "name" : "Document Details",
        "uuid" : "62a7209d-40b2-46e9-85df-357d4e7b04b0",
        "dataType" : "QuestionGroup",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 1.0,
      "type" : "SingleSelect",
      "rule" : "",
      "mandatory" : false
    }, {
      "name" : "Nature of document",
      "uuid" : "3a0f9e7a-d26a-4127-9810-596178b74219",
      "keyValues" : [ ],
      "concept" : {
        "name" : "Nature of Document",
        "uuid" : "5b26030d-7fd2-4aa7-b7ad-d29afd0e2f3b",
        "dataType" : "Coded",
        "answers" : [ {
          "name" : "First Appeal Order",
          "uuid" : "9faf041e-9d2c-49eb-a5a0-7f4881451ec7",
          "dataType" : "NA",
          "answers" : [ ],
          "order" : 3.0,
          "active" : true,
          "media" : [ ]
        }, {
          "name" : "Second appeal order",
          "uuid" : "016d5b31-f6e0-4edf-b638-6c7d018c4cf5",
          "dataType" : "NA",
          "answers" : [ ],
          "order" : 5.0,
          "active" : true,
          "media" : [ ]
        }, {
          "name" : "Information Received",
          "uuid" : "c18f6e4b-70d4-4101-b710-65f48bc00478",
          "dataType" : "NA",
          "answers" : [ ],
          "order" : 6.0,
          "active" : true,
          "media" : [ ]
        }, {
          "name" : "Response from PIO",
          "uuid" : "8b9f2c9b-a8ee-4813-a2e2-773dda94a5bd",
          "dataType" : "NA",
          "answers" : [ ],
          "order" : 1.0,
          "active" : true,
          "media" : [ ]
        }, {
          "name" : "RTI application",
          "uuid" : "91234bd0-bfd8-4600-9f9a-184be9078a28",
          "dataType" : "NA",
          "answers" : [ ],
          "order" : 0.0,
          "active" : true,
          "media" : [ ]
        }, {
          "name" : "Second appeal application",
          "uuid" : "0324259a-f1aa-42a7-ac54-81f9364a15d2",
          "dataType" : "NA",
          "answers" : [ ],
          "order" : 4.0,
          "active" : true,
          "media" : [ ]
        }, {
          "name" : "First Appeal Application",
          "uuid" : "028b7fcd-6a82-4e99-8cd2-21516d99265f",
          "dataType" : "NA",
          "answers" : [ ],
          "order" : 2.0,
          "active" : true,
          "media" : [ ]
        } ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 2.0,
      "type" : "SingleSelect",
      "parentFormElementUuid" : "c556c204-4d0e-48ce-86dc-40d097a932dc",
      "mandatory" : true
    }, {
      "name" : "Name of Document",
      "uuid" : "f976195c-70d2-49ce-9ae6-91e4ffd9ddd4",
      "keyValues" : [ ],
      "concept" : {
        "name" : "Name of document",
        "uuid" : "7340c406-aea4-4b37-a28a-5bc7d0e62f9f",
        "dataType" : "Text",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 3.0,
      "type" : "SingleSelect",
      "parentFormElementUuid" : "c556c204-4d0e-48ce-86dc-40d097a932dc",
      "mandatory" : true
    }, {
      "name" : "Date of Document",
      "uuid" : "d36dbd4d-2f72-4ca4-96a6-85503d8e85da",
      "keyValues" : [ {
        "key" : "datePickerMode",
        "value" : "calendar"
      } ],
      "concept" : {
        "name" : "Date of document",
        "uuid" : "241786fc-f1a5-4c6d-bdb5-3ad5c7e1cf32",
        "dataType" : "Date",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 4.0,
      "type" : "SingleSelect",
      "rule" : "'use strict';\n({params, imports}) => {\n  const encounter = params.entity;\n  const moment = imports.moment;\n  const formElement = params.formElement;\n  const _ = imports.lodash;\n  let visibility = true;\n  let value = null;\n  let answersToSkip = [];\n  let validationErrors = [];\n  const questionGroupIndex = params.questionGroupIndex;\n  let documentDetails = encounter.getObservationValue(\"62a7209d-40b2-46e9-85df-357d4e7b04b0\");\n  \n  if(documentDetails && documentDetails.length > 0){\n\n    let currentQuestionGroup = documentDetails[questionGroupIndex]\n    let selectedDate = currentQuestionGroup.findObservationByConceptUUID('241786fc-f1a5-4c6d-bdb5-3ad5c7e1cf32');\n\n    if(selectedDate) {\n      \n      const currentDate = moment().startOf('day');\n      selectedDate = moment(selectedDate.getValue()).startOf('day');\n      if(selectedDate.isAfter(currentDate)){\n          validationErrors.push(\"Invalid date: Future dates are not allowed\");\n      }\n    } \n  }\n  \n  return new imports.rulesConfig.FormElementStatus(formElement.uuid, visibility, value, answersToSkip, validationErrors);\n};",
      "parentFormElementUuid" : "c556c204-4d0e-48ce-86dc-40d097a932dc",
      "mandatory" : true
    }, {
      "name" : "Upload file",
      "uuid" : "966c3ec9-6f42-4c2e-a448-a9d65f7adb01",
      "keyValues" : [ {
        "key" : "allowedMaxSize",
        "value" : 1
      } ],
      "concept" : {
        "name" : "upload file",
        "uuid" : "62f8725b-2df0-4765-b9c4-781f8c1e2e3e",
        "dataType" : "File",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 5.0,
      "type" : "SingleSelect",
      "rule" : "",
      "parentFormElementUuid" : "c556c204-4d0e-48ce-86dc-40d097a932dc",
      "mandatory" : false
    }, {
      "name" : "Upload Image",
      "uuid" : "4d67cb1d-dc93-4815-bdef-d06f7a81a9a3",
      "keyValues" : [ ],
      "concept" : {
        "name" : "Upload Image",
        "uuid" : "fe30a8b6-0c79-4fb6-988a-4f2a717a8fbe",
        "dataType" : "Image",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 6.0,
      "type" : "SingleSelect",
      "parentFormElementUuid" : "c556c204-4d0e-48ce-86dc-40d097a932dc",
      "mandatory" : false
    } ],
    "rule" : "",
    "display" : "Document",
    "timed" : false
  } ],
  "decisionRule" : "\"use strict\";\n({params, imports}) => {\n    const programEncounter = params.entity;\n    const decisions = params.decisions;\n    const moment = imports.moment;\n    const encounterDecisions = [];\n    \n    const encounterDateForEditCase = programEncounter.getObservationValue(\"1f4bc226-9e3f-42c9-a332-2d81cd8e64f7\");\n    \n    if (!encounterDateForEditCase) {\n      let encDateTime = moment().format(\"YYYY-MM-DD HH:mm:ss\");\n      \n      if (encDateTime) {\n        encounterDecisions.push({ name: \"Encounter DateTime\", value: encDateTime });\n      }\n      decisions.encounterDecisions.push(...encounterDecisions);\n    }\n    return decisions;\n};",
  "visitScheduleRule" : "",
  "validationRule" : "'use strict';\n({params, imports}) => {\n  const programEncounter = params.entity;\n  const validationResults = [];\n  const formElement = params.formElement;\n  const _ = imports.lodash;\n  let validationErrors = [];\n  const moment = imports.moment;\n  \n  let documentDetails = programEncounter.findGroupedObservation(\"62a7209d-40b2-46e9-85df-357d4e7b04b0\");\n  if(documentDetails && documentDetails.length > 0){\n\n    for(let i = 0;i<documentDetails.length;i++){\n      let currentQuestionGroup = documentDetails[i]\n      let uploadFile = currentQuestionGroup.findObservationByConceptUUID(\"62f8725b-2df0-4765-b9c4-781f8c1e2e3e\");\n      let uploadImage =  currentQuestionGroup.findObservationByConceptUUID(\"fe30a8b6-0c79-4fb6-988a-4f2a717a8fbe\");\n\n      if((uploadFile === null || uploadFile === undefined) && (uploadImage === null || uploadImage === undefined)){\n        let validationError = imports.common.createValidationError('Please upload either image or file');\n        validationResults.push(validationError);\n      }\n    }\n  }  \n  \n  const encounterDateForEditCase = programEncounter.getObservationValue(\"1f4bc226-9e3f-42c9-a332-2d81cd8e64f7\");\n  const encounterDate = programEncounter.encounterDateTime;\n\n  if (!encounterDateForEditCase) {\n    if (encounterDate) {\n      const today = moment().startOf('day');\n      const encDate = moment(encounterDate).startOf('day');\n\n      if (!encDate.isSame(today, 'day')) {\n        validationResults.push(\n          imports.common.createValidationError(\"Encounter Date should be today's date.\")\n        );\n      }\n    }\n  } else {\n    const encDateEdit = moment(encounterDate).startOf('day');\n    const encDateOriginal = moment(encounterDateForEditCase).startOf('day');\n\n    if (!encDateEdit.isSame(encDateOriginal, 'day')) {\n      validationResults.push(\n        imports.common.createValidationError(\"Encounter Date cannot be changed.\")\n      );\n    }\n  }\n  \n  return validationResults;\n};",
  "checklistsRule" : "",
  "decisionConcepts" : [ ]
}