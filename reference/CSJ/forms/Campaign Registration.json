{
  "name" : "Campaign Registration",
  "uuid" : "aa820ac3-404f-4377-82ad-41450ab01737",
  "formType" : "IndividualProfile",
  "formElementGroups" : [ {
    "uuid" : "82d1fab1-0fc5-4dc1-b0a6-c0a683637dc2",
    "name" : "Campaign Details",
    "displayOrder" : 1.0,
    "formElements" : [ {
      "name" : "Campaign Start Date",
      "uuid" : "217c559b-0b14-448c-b684-2b79e4ee721e",
      "keyValues" : [ {
        "key" : "datePickerMode",
        "value" : "calendar"
      } ],
      "concept" : {
        "name" : "StartDate",
        "uuid" : "8102a34f-6d41-484c-b3dc-23208abacbea",
        "dataType" : "Date",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 1.0,
      "type" : "SingleSelect",
      "mandatory" : true
    }, {
      "name" : "Campaign End Date",
      "uuid" : "6a16de14-c2a4-4aab-ba1c-9af0b473e4f1",
      "keyValues" : [ {
        "key" : "datePickerMode",
        "value" : "calendar"
      } ],
      "concept" : {
        "name" : "EndDate",
        "uuid" : "c63113ca-5dec-4048-bf99-fe51f36f7dfb",
        "dataType" : "Date",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 2.0,
      "type" : "SingleSelect",
      "rule" : "'use strict';\n({params, imports}) => {\n  const individual = params.entity;\n  const moment = imports.moment; \n  const formElement = params.formElement;\n  const _ = imports.lodash;\n  let visibility = true;\n  let value = null;\n  let answersToSkip = [];\n  let validationErrors = [];\n\n  const startDate = individual.getObservationReadableValue('StartDate');\n  const endDate = individual.getObservationReadableValue('EndDate');\n\n  if (startDate && endDate) {\n    const startMoment = moment(startDate, 'YYYY-MM-DD'); \n    const endMoment = moment(endDate, 'YYYY-MM-DD');\n\n    if (!endMoment.isAfter(startMoment)) {\n      validationErrors.push('End date must be after the start date.');\n    }\n  }\n\n  return new imports.rulesConfig.FormElementStatus(formElement.uuid, visibility, value, answersToSkip, validationErrors);\n};\n",
      "mandatory" : true
    }, {
      "name" : "Objective",
      "uuid" : "5e1a7e53-74f4-4d54-8aa7-253818379ed3",
      "keyValues" : [ ],
      "concept" : {
        "name" : "Objective",
        "uuid" : "cd59dabe-046a-4618-92c9-c08bb88206ef",
        "dataType" : "Text",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 3.0,
      "type" : "SingleSelect",
      "mandatory" : false
    }, {
      "name" : "Brief description",
      "uuid" : "8cdb7a6c-76a7-4652-8c7e-30e1f928ceac",
      "keyValues" : [ ],
      "concept" : {
        "name" : "BriefDescription",
        "uuid" : "6ec307a8-afb9-413c-ae64-aa76284769c6",
        "dataType" : "Text",
        "answers" : [ ],
        "active" : true,
        "media" : [ ]
      },
      "displayOrder" : 4.0,
      "type" : "SingleSelect",
      "mandatory" : false
    } ],
    "rule" : "({params, imports}) => {\n    const individual = params.entity;\n    const moment = imports.moment;\n    const formElementGroup = params.formElementGroup;\n    const _ = imports.lodash;\n    let visibility = true;\n\n    return formElementGroup.formElements.map((formElement) => {\n    \n    let autoName = `Campaign_`;\n        if (individual) {\n            const adminUnit =  individual.lowestAddressLevel.name;\n            let startDate = individual.getObservationValue('8102a34f-6d41-484c-b3dc-23208abacbea');\n            let monthStr = '';\n            if (startDate) {\n                const m = moment(startDate);\n                monthStr = m.format('MMMM');\n            }\n            \n            \n            let autoName = `Campaign_${adminUnit}_${monthStr}`;\n            individual.firstName = autoName;\n            individual.name = autoName;\n        }\n            return new imports.rulesConfig.FormElementStatus(formElement.uuid, visibility, null);\n    });\n};\n\n",
    "display" : "Campaign Details",
    "timed" : false
  } ],
  "decisionRule" : "//SAMPLE RULE EXAMPLE\n  \"use strict\";\n({params, imports}) => {\n    const individual = params.entity;\n    const decisions = params.decisions;\n    const moment = imports.moment;\n    const registrationDecisions = [];\n    \n    let createdByName = params.user.name;\n    let createdByUUID = params.user.uuid;\n    let createdByUsername = params.user.username;\n    \n    const registrationDateForEditCase = individual.getObservationValue(\"7b1a1540-bfd5-484d-987f-4d6f3635a448\");\n    if (!registrationDateForEditCase) {\n      let regDateTime = moment().format(\"YYYY-MM-DD HH:mm:ss\");\n      if (regDateTime) {\n        registrationDecisions.push({ name: \"Registration DateTime\", value: regDateTime });\n      }\n    }\n    \n    if(createdByName){\n      registrationDecisions.push({name: \"Created By Name\", value: createdByName});  \n    }\n    \n    if(createdByUsername){\n      registrationDecisions.push({name: \"Created By Username\", value: createdByUsername});    \n    }\n    \n    decisions.registrationDecisions.push(...registrationDecisions);\n        \n    return decisions;\n};",
  "visitScheduleRule" : "",
  "validationRule" : "'use strict';\n({ params, imports }) => {\n  const individual = params.entity;\n  const moment = imports.moment;\n  const validationResults = [];\n\n  const registrationDateForEditCase = individual.getObservationValue(\"7b1a1540-bfd5-484d-987f-4d6f3635a448\");\n  const registrationDate = individual.registrationDate;\n\n  if (!registrationDateForEditCase) {\n    if (registrationDate) {\n      const today = moment().startOf('day');\n      const regDate = moment(registrationDate).startOf('day');\n\n      if (!regDate.isSame(today, 'day')) {\n        validationResults.push(\n          imports.common.createValidationError(\"Registration Date should be today's date.\")\n        );\n      }\n    }\n  } else {\n    const regDateEdit = moment(registrationDate).startOf('day');\n    const regDateOriginal = moment(registrationDateForEditCase).startOf('day');\n\n    if (!regDateEdit.isSame(regDateOriginal, 'day')) {\n      validationResults.push(\n        imports.common.createValidationError(\"Registration Date cannot be changed.\")\n      );\n    }\n  }\n\n  return validationResults;\n};",
  "checklistsRule" : "",
  "decisionConcepts" : [ {
    "name" : "Created By Username",
    "uuid" : "836f9b19-bebb-4295-8519-9c7c6a4e4d15",
    "dataType" : "Text",
    "answers" : [ ],
    "active" : true,
    "keyValues" : [ ],
    "media" : [ ]
  }, {
    "name" : "Created By Name",
    "uuid" : "5d9875ad-9f13-4243-8e1f-edfe00c18866",
    "dataType" : "Text",
    "answers" : [ ],
    "active" : true,
    "keyValues" : [ ],
    "media" : [ ]
  } ]
}